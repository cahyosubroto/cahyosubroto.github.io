<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.17" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.58" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://docs.aklivity.io/zilla-docs/next/solutions/how-tos/amazon-msk/iot-ingest-control.html"><meta property="og:site_name" content="Documentation"><meta property="og:title" content="Amazon MSK IoT Ingest and Control"><meta property="og:description" content="The IoT Ingest and Control MQTT Broker that lets clients publish messages and subscribe to topics proxied to Kafka topics in your Amazon MSK cluster."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Amazon MSK IoT Ingest and Control","image":[""],"dateModified":null,"author":[]}</script><meta name="docsearch:product" content="zilla-docs"><meta name="docsearch:version" content="next"><link rel="preconnect" href="https://H6RNUBSB6E-dsn.algolia.net" crossorigin=""><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Questrial&display=swap" rel="stylesheet"><link rel="icon" href="/zilla-docs/next/favicon.ico"><title>Amazon MSK IoT Ingest and Control | Documentation</title><meta name="description" content="The IoT Ingest and Control MQTT Broker that lets clients publish messages and subscribe to topics proxied to Kafka topics in your Amazon MSK cluster.">
    <link rel="preload" href="/zilla-docs/next/assets/style-D_CRXaJP.css" as="style"><link rel="stylesheet" href="/zilla-docs/next/assets/style-D_CRXaJP.css">
    <link rel="modulepreload" href="/zilla-docs/next/assets/app-DWA4uJ8g.js"><link rel="modulepreload" href="/zilla-docs/next/assets/iot-ingest-control.html-BsUBcQQh.js"><link rel="modulepreload" href="/zilla-docs/next/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/zilla-docs/next/assets/overview.html-Bj0esRC1.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BOYAOlON.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/bindings.html-SO1NJWnX.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/catalogs.html-CkotABKH.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/guards.html-ZZS-w29D.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/models.html-BcHW2MTa.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/protocol.html-DbK6dt7s.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/spec-generation.html-iBBp2Z39.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/ssl.html-DJ6xKTkg.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/telemetry.html-dSHoa8DI.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/use-cases.html-Dn7_hrBu.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/vaults.html-D6BM5z8a.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/what-is-zilla.html-rJ0k0EJz.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/zilla-plus-aws-ecs-fargate.html-BNRmY9vV.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/grpc-proxy.html-C-HZMr73.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/http-proxy.html-QB0_rMHu.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/mqtt-proxy.html-CBeBN5NM.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-C2v3AUMZ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BnJTAjvv.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-Dpt6_RbP.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-D8-XKhAb.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-rvVBmvKJ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-nv27frO2.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BLTJvIp8.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/aiven.html-BV23QBKg.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/amazon-msk.html-C0pN9eLp.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/apache-kafka.html-BbKoPpfL.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/confluent-cloud.html-kYeSDbx7.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/redpanda.html-D6wwZmlF.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/autoscale-k8s.html-Dx4ynNID.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-Bpdxlafw.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/grpc.route-guide.service.html-CSOBNTQn.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BkE7Pqgd.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/mqtt.kafka.broker.html-DF9cJTal.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-3WaRvywv.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/opentelemetry-protocol.html-BkrpTCNv.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/overview.html-Chx_prnw.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/resolvers.html-DStx4ztO.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/zilla-cli.html-PBzQnKHg.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/overview.html-DDn2qmrM.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/zpm-cli.html-CjWQwjBi.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/grpc-intro.html-vwuIFmeF.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/mqtt-intro.html-Cz7r9gNb.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/rest-intro.html-C9_1jiXQ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/sse-intro.html-lVJM89rV.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/telemetry-intro.html-BVVDPidZ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/filesystem.html-h9yyRO_B.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-4yWnjN78.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/kafka.html-CE9gK24s.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-DMBYNKC2.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-CMcIhEL1.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/filesystem.html-DCylxa3H.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/kafka.html-BMbk5IJA.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-NPUaxgM4.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/cache_client.html-BJTKHajO.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/cache_server.html-eVE2WjR7.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-BVtZjXtW.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/proxy.html-n6ItJ7m_.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/remote_server.html-ewCzxLNA.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-CConTfpC.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/kafka_proxy.html-TwqMA6rG.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-dQsCiGs6.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/apicurio-registry.html-Ma20pWH5.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/aws-glue.html-B5uyf6RL.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/confluent-schema-registry.html-DBvh90rC.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/filesystem.html-DWlKe_CY.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/inline.html-BA36ZDJs.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/karapace-schema-registry.html-DUCfRDzl.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/schema-registry.html-C16R8Qs3.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/jwt.html-Ds_w3JCi.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/events.html-Bbel8Nap.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/aws-acm.html-D7bALSgs.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/aws-secrets.html-usfTUZUJ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/filesystem.html-BPKZW8FY.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/iot-ingest-control.html-Dve5ZhHP.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/secure-public-access.html-CpEJT_cB.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/web-streaming.html-BSSmk3Cm.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-B5zbIwCH.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/web-streaming.html-CecA38eL.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/avro.html-DrNSFxr0.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/double.html-BIeJxTPq.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/float.html-BMlb9aK7.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/int32.html-BEhPreV7.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/int64.html-laiypUoO.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/json.html-Bi6qHQEq.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/protobuf.html-DMp5USr5.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/string.html-BlZuwhpw.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/create-certificate-authority-acm.html-BEfdGB8r.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/create-client-certificate-acm.html-BUM6MNNm.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/create-iam-role.html-CVJ0hNsl.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/create-key-pair.html-BFKeJdBt.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/create-msk-cluster.html-BJ-wPlKj.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/create-server-certificate-acm.html-CUkqx2UL.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/create-server-certificate-letsencrypt.html-BxB8frbf.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/create-vpc.html-B80uIdTM.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/launch-ec2-instance.html-CE1bfCQg.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/lookup-msk-server-names.html-BOULOm2-.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/manage-cloudformation-stack.html-e2gVRy2c.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/troubleshooting.html-eb3Xs2WE.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DT6caD_h.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/iot-ingest-control.html-BOitIv_f.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/secure-public-access.html-BCoLZMxg.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DFmRx3OG.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/iot-ingest-control.html-jNzewLyU.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-8aD4yULQ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-B8RXH2xf.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-DSZV4A9b.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/proxy.html-DWB1yfIR.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-D5ZOaara.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-Pu2509Pj.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-YavJJY88.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-Btmsqs0a.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-C24wFRYP.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-DM1IV6Ef.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BomYU7gw.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-IUQah_gz.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-DkeATVOD.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DCQDYf6N.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-DczDW6C6.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/proxy.html-Bna6YK57.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-CRrSkmNe.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-CCd9GCWZ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BJ2DA9bb.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-CtH-jwXj.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/proxy.html-Ce84dMtj.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-NUyxFOYa.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/proxy.html-Cr1vw-J7.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DLL19Vef.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/cache_client.html-CiRuTs-c.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/cache_server.html-CT9SdfK6.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-9_WmHcwr.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DiLQZZeU.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-CWMIPRlh.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/remote_server.html-CzloDDej.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/proxy.html-DUxYMjHt.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-R49ibyv4.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-CmoPa5ON.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-sB8EuyuH.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-S1sqPED7.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/proxy.html-D9mizIEA.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-B1MTV3MK.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-BZn3CLzO.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-CY8z5_zu.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-C8Kk5Mm1.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/proxy.html-umcRti0k.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BFoNlkM3.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-DKC32REf.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-uS9PMWft.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-D8e-ECQu.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-Dq_pj1fK.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DrLnhxPY.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-B49jW0h3.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/proxy.html-AtFKfs8g.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-CZuQxtHt.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-D_piyWN6.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DyS4cCqc.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-DHumqGTG.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-CeUWCyqM.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/proxy.html-G70TIOTU.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-2yyhc-aK.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-DLt02reZ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/client.html-DCxbtgtX.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BgBFlDUs.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/server.html-Cqc7mfON.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/aws-cloudwatch.html-BDhxKCd5.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/otlp.html-B9Bv_-rf.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/prometheus.html-DprC9sK_.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/stdout.html-BMs-W3Jy.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/syslog.html-Dbp-ma2b.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/grpc.html-KvfLk7Ac.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/http.html-DnuL_PG7.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/stream.html-0sR147SI.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/development.html-DHMKMjd4.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/production-mutual-tls.html-C05avSfX.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/production.html-DGwpchke.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/404.html-BiR3y_du.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-C5oMjmBp.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BKtdmxJc.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-Bxr_fqGI.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BvvANRst.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-CE9qeooL.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BFhTWiZZ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BgX2g4Ip.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DToc8f-X.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-kKs4OlIJ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-xv7MZ-Ig.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DRZ-0z1D.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-C9GJ7GKc.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DgB96tGw.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BW9OO1ac.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-CKyrInGX.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-EYoBwGnD.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-Bn2qb-WI.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-G_rkRMQC.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-Cf0W0FGo.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-S1SjNUcl.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BvesjY8q.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BCZUj4ql.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-B10tYJXj.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-lE3R9O8x.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-CyWcvZ8G.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-CHxk-2e-.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-BgCnWe2Z.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-qs5hN0Eq.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-kMGTinDC.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-Dqt2Z2YF.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-J0J_wquY.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-CjLu_xtm.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DtThtFvF.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DTat6ObQ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-50TfYgsm.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-CWXVmAgV.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index.html-DS0hZmu2.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/mermaid.esm.min-62vNQt_g.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/photoswipe.esm-GXRgw7eJ.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/index-DCs6OeCW.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/ZillaPlus-BdYa_-zY.js" as="script"><link rel="prefetch" href="/zilla-docs/next/assets/setupDevtools-7MC2TMWH-Dw61r3O2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><!--[--><div class="theme-container external-link-icon pure has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/zilla-docs/next/" aria-label="Take me home"><img class="vp-nav-logo light" src="/zilla-docs/next/logo.webp" alt><img class="vp-nav-logo dark" src="/zilla-docs/next/logo-dark.webp" alt><span class="vp-site-name hide-in-pad">Documentation</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/zilla-docs/next/how-tos/quickstart/" aria-label="Get Started"><!--[--><span class="font-icon icon fas fa-play" style=""></span><!--]-->Get Started<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/zilla-docs/next/solutions/concepts/kafka-proxies/secure-public-access.html" aria-label="Solutions"><!--[--><span class="font-icon icon fas fa-shapes" style=""></span><!--]-->Solutions<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/zilla-docs/next/reference/config/overview.html" aria-label="Reference"><!--[--><span class="font-icon icon fas fa-book" style=""></span><!--]-->Reference<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="version"><!--[--><span class="font-icon icon fas fa-list-ol" style=""></span>version<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://github.com/orgs/aklivity/projects/4" aria-label="Roadmap" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fas fa-bars-progress" style=""></span><!--]-->Roadmap<!----></a></li><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://github.com/aklivity/zilla/releases" aria-label="Changelog" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fas fa-tag" style=""></span><!--]-->Changelog<!----></a></li><li class="vp-dropdown-item"><a class="auto-link external-link" href="https://docs.aklivity.io/zilla-docs/next" aria-label="@next" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fas fa-circle-right" style=""></span><!--]-->@next<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="auto-link external-link" href="https://www.aklivity.io/" aria-label="aklivity" rel="noopener noreferrer" target="_blank"><!--[--><span class="font-icon icon fas fa-globe" style=""></span><!--]-->aklivity<!----></a></div></nav><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/aklivity/zilla" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon aky-zilla-plus" style=""></span><span class="vp-sidebar-title">Secure Public Access</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><!----><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/zilla-docs/next/solutions/concepts/kafka-proxies/secure-public-access.html" aria-label="Deployment Options"><!---->Deployment Options<!----></a><!----></p><ul class="vp-sidebar-links"></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/zilla-docs/next/solutions/how-tos/amazon-msk/secure-public-access/production.html" aria-label="Amazon MSK"><!---->Amazon MSK<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><!----><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/zilla-docs/next/solutions/how-tos/confluent-cloud/secure-public-access.html" aria-label="Confluent Cloud"><!---->Confluent Cloud<!----></a><!----></p><ul class="vp-sidebar-links"></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon aky-zilla-plus" style=""></span><span class="vp-sidebar-title">IoT Ingest and Control</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><!----><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/zilla-docs/next/solutions/concepts/kafka-proxies/iot-ingest-control.html" aria-label="Deployment Options"><!---->Deployment Options<!----></a><!----></p><ul class="vp-sidebar-links"></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable exact"><!----><a class="route-link route-link-active auto-link vp-sidebar-title no-external-link-icon" href="/zilla-docs/next/solutions/how-tos/amazon-msk/iot-ingest-control.html" aria-label="Amazon MSK"><!---->Amazon MSK<!----></a><!----></p><ul class="vp-sidebar-links"></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><!----><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/zilla-docs/next/solutions/how-tos/confluent-cloud/iot-ingest-control.html" aria-label="Confluent Cloud"><!---->Confluent Cloud<!----></a><!----></p><ul class="vp-sidebar-links"></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><!----><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/zilla-docs/next/solutions/how-tos/redpanda/iot-ingest-control.html" aria-label="Redpanda"><!---->Redpanda<!----></a><!----></p><ul class="vp-sidebar-links"></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><span class="font-icon icon aky-zilla-plus" style=""></span><span class="vp-sidebar-title">Web Streaming</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><!----><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/zilla-docs/next/solutions/concepts/kafka-proxies/web-streaming.html" aria-label="Deployment Options"><!---->Deployment Options<!----></a><!----></p><ul class="vp-sidebar-links"></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><!----><span class="vp-sidebar-title">Amazon MSK</span><!----></p><ul class="vp-sidebar-links"><li><a class="auto-link external-link vp-sidebar-link" href="https://github.com/aklivity/zilla-plus-aws-templates/tree/main/amazon-msk/cdktf/web-streaming" aria-label="Terraform" rel="noopener noreferrer" target="_blank"><!---->Terraform<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><!----><span class="vp-sidebar-title">Other Resources</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header"><!----><span class="vp-sidebar-title">AWS</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-msk-cluster.html" aria-label="Create an MSK Cluster"><!---->Create an MSK Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-certificate-authority-acm.html" aria-label="Create Certificate Authority"><!---->Create Certificate Authority<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-client-certificate-acm.html" aria-label="Create Client Certificate"><!---->Create Client Certificate<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-iam-role.html" aria-label="Create IAM Role"><!---->Create IAM Role<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-key-pair.html" aria-label="Create Key Pair"><!---->Create Key Pair<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-server-certificate-acm.html" aria-label="Create Server Certificate"><!---->Create Server Certificate<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-server-certificate-letsencrypt.html" aria-label="Create Server Certificate (LetsEncrypt)"><!---->Create Server Certificate (LetsEncrypt)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-vpc.html" aria-label="Create VPC"><!---->Create VPC<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/launch-ec2-instance.html" aria-label="Launch EC2 Instance"><!---->Launch EC2 Instance<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/lookup-msk-server-names.html" aria-label="Lookup MSK Server Names"><!---->Lookup MSK Server Names<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/manage-cloudformation-stack.html" aria-label="Manage a Cloudformation Stack"><!---->Manage a Cloudformation Stack<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/zilla-docs/next/solutions/how-tos/aws-services/troubleshooting.html" aria-label="Troubleshooting"><!---->Troubleshooting<!----></a></li></ul></section></li></ul></section></li></ul><!----></aside><!--[--><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon aky-zilla-plus" style=""></span>Amazon MSK IoT Ingest and Control</h1><div class="page-info"><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#overview">Overview</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#prerequisites">Prerequisites</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#aws-services-used">AWS services used</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#create-the-amazon-msk-cluster">Create the Amazon MSK cluster</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#create-a-secret-with-sasl-scram-authentication-params">Create a Secret with SASL/SCRAM authentication params</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#zilla-proxy-aws-resources">Zilla proxy AWS resources</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#create-the-vpc">Create the VPC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#create-the-security-group">Create the security group</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#create-the-iam-security-role">Create the IAM security role</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#subscribe-via-aws-marketplace">Subscribe via AWS Marketplace</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#deploy-the-iot-ingest-and-control-mqtt-broker">Deploy the IoT Ingest and Control MQTT Broker</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#step-1-create-stack">Step 1. Create Stack</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#step-2-specify-stack-details">Step 2. Specify stack details</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#step-3-configure-stack-options-use-defaults">Step 3. Configure stack options: (use defaults)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#step-4-review">Step 4. Review</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#configure-global-dns">Configure Global DNS</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#verify-mqtt-client-connectivity">Verify MQTT Client Connectivity</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#connect-with-an-mqtt-client">Connect with an MQTT Client</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#subscribe-to-a-topic">Subscribe to a topic</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#publish-to-a-topic">Publish to a topic</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#verify-the-zilla-proxy-service">Verify the Zilla proxy Service</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#conclusion">Conclusion</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content" vp-content><h1 id="amazon-msk-iot-ingest-and-control" tabindex="-1"><a class="header-anchor" href="#amazon-msk-iot-ingest-and-control"><span>Amazon MSK IoT Ingest and Control</span></a></h1><p class="zilla-plus-badge hint-container info"><a href="https://www.aklivity.io/products/zilla-plus" target="_blank" rel="noopener noreferrer">Available in <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--></a></p><div class="hint-container info"><p class="hint-container-title">Estimated time to complete 10-15 minutes.</p></div><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h2><p>The <a href="https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44" target="_blank" rel="noopener noreferrer">Zilla Plus for Amazon MSK</a> IoT Ingest and Control MQTT Broker lets clients publish messages and subscribe to topics that are proxied to Kafka topics in your Amazon MSK cluster.</p><h2 id="prerequisites" tabindex="-1"><a class="header-anchor" href="#prerequisites"><span>Prerequisites</span></a></h2><p>Before creating an IoT Ingest and Control MQTT Broker to your Kafka cluster, you will need the following:</p><ul><li>a Kafka cluster configured for SASL/SCRAM authentication</li><li>a custom DNS wildcard domain, for this guide we will use <code>*.example.aklivity.io</code></li><li>a TLS Server Certificate stored in Secrets Manager for your custom DNS wildcard domain</li></ul><div class="hint-container info"><p class="hint-container-title">Info</p><p>Note the server certificate secret ARN as we will need to reference it from the IoT Ingest and Control CloudFormation template.</p><p>Make sure you have selected the desired region, ex: <code>US East (N. Virginia) us-east-1</code>.</p><p>If you need help creating a TLS Server Certificate you can follow the <a class="route-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-server-certificate-letsencrypt.html">Create Server Certificate with LetsEncrypt</a> guide. Use your own custom DNS wildcard domain in place of the example domain <code>*.example.aklivity.io</code>.</p></div><h3 id="aws-services-used" tabindex="-1"><a class="header-anchor" href="#aws-services-used"><span>AWS services used</span></a></h3><table><thead><tr><th>Service</th><th>Required</th><th>Usage</th><th>Quota</th></tr></thead><tbody><tr><td>Secrets Manager</td><td>Yes</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/asm.html#limits_secrets-manager" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr><tr><td>Certificate Manager</td><td>No<br><br>Private key and certificate can be inline in Secrets Manager instead</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/acm.html#limits_acm" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr><tr><td>Private Certificate Manager</td><td>No<br><br>Private key and certificate can be inline in Secrets Manager instead</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/acm-pca.html#limits_acm-pca" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr></tbody></table><p>Default <a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html" target="_blank" rel="noopener noreferrer">AWS Service Quotas</a> are recommended.</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>Check out the <a class="route-link" href="/zilla-docs/next/solutions/how-tos/aws-services/troubleshooting.html">Troubleshooting</a> guide if you run into any issues.</p></div><h2 id="create-the-amazon-msk-cluster" tabindex="-1"><a class="header-anchor" href="#create-the-amazon-msk-cluster"><span>Create the Amazon MSK cluster</span></a></h2><blockquote><p>This creates your MSK cluster in preparation for secure access via the internet.</p></blockquote><p>An MSK cluster is needed for secure remote access via the internet. You can skip this step if you have already created an MSK cluster with equivalent configuration.</p><p>Follow the <a class="route-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-msk-cluster.html">Create MSK Cluster</a> guide to setup the a new MSK cluster. We will use the below resource names to reference the AWS resources needed in this guide.</p><ul><li>Cluster Name: <code>my-zilla-iot-msk-cluster</code></li><li>Access control methods: <code>SASL/SCRAM authentication</code></li></ul><p>With a running MSK Cluster you will need to create these topics. You can reference this AWS developer guide for help <a href="https://docs.aws.amazon.com/msk/latest/developerguide/create-topic.html" target="_blank" rel="noopener noreferrer">creating topics</a>.</p><ul><li><p>Topics:</p><ul><li>With cleanup policy &quot;delete&quot; to store MQTT messages:</li></ul><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>mqtt-messages</span></span></code></pre></div><ul><li>With cleanup policy &quot;compact&quot; to store MQTT retained messages:</li></ul><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>mqtt-retained</span></span></code></pre></div><ul><li>With cleanup policy &quot;compact&quot; to store MQTT sessions:</li></ul><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>mqtt-sessions</span></span></code></pre></div></li></ul><h3 id="create-a-secret-with-sasl-scram-authentication-params" tabindex="-1"><a class="header-anchor" href="#create-a-secret-with-sasl-scram-authentication-params"><span>Create a Secret with SASL/SCRAM authentication params</span></a></h3><p>When the MSK cluster is created you will need to follow the <a href="https://docs.aws.amazon.com/msk/latest/developerguide/msk-password.html" target="_blank" rel="noopener noreferrer">Sign-in credentials authentication with AWS Secrets Manager</a> to associate your <code>AmazonMSK_*</code> secret to your cluster. There will be a prompt on the cluster summary page to create a new secret or associate an existing one. For the remainder of this doc we will assume the following values for this secret:</p><ul><li><p>Secret Type: <code>Other type of secret</code></p></li><li><p>Value:</p><ul><li>Plaintext JSON object:</li></ul><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">{</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;username&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;alice&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;password&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;alice-secret&quot;</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">}</span></span></code></pre></div></li><li><p>Encryption key: <code>&lt;Customer managed key&gt;</code></p></li><li><p>Secret Name: <code>AmazonMSK_access</code></p></li><li><p>Review and store the secret</p></li></ul><div class="hint-container caution"><p class="hint-container-title">Important</p><p>A secret created with the default AWS KMS key cannot be used with an Amazon MSK cluster.</p></div><p>Go to the newly created secret and under <code>Resource permissions</code> &gt; select <code>Edit Permissions</code>. Add the below <code>AWSKafkaResourcePolicy</code> and replace the resource secret name with your SASL/SCRAM auth secret name.</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">{</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;Version&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> : </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;2012-10-17&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;Statement&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> : [ {</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">    &quot;Sid&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> : </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;AWSKafkaResourcePolicy&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">    &quot;Effect&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> : </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;Allow&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">    &quot;Principal&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> : {</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">      &quot;Service&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> : </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;kafka.amazonaws.com&quot;</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">    },</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">    &quot;Action&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> : </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;secretsmanager:getSecretValue&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">    &quot;Resource&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> : </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;arn:aws:secretsmanager:*:*:secret:&lt;SASL/SCRAM auth secret name&gt;*&quot;</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">  } ]</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">}</span></span></code></pre></div><h2 id="zilla-proxy-aws-resources" tabindex="-1"><a class="header-anchor" href="#zilla-proxy-aws-resources"><span>Zilla proxy AWS resources</span></a></h2><p>We need to create the AWS resources necessary to allow access to the IoT Ingest and Control MQTT Broker from the internet, the <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--> proxy instances access to Secrets Manager secrets, and SSH access to the instances for troubleshooting.</p><h3 id="create-the-vpc" tabindex="-1"><a class="header-anchor" href="#create-the-vpc"><span>Create the VPC</span></a></h3><blockquote><p>This creates your <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--> proxy VPC in preparation for access from an MQTT client.</p></blockquote><p><a href="https://docs.aws.amazon.com/vpc/latest/userguide/create-vpc.html#create-vpc-and-other-resources" target="_blank" rel="noopener noreferrer">Create a VPC plus other VPC resources</a> with the below resource names.</p><ul><li>Name tag auto-generation: <code>my-zilla-iot-proxy</code></li><li>VPC endpoints: <code>none</code></li><li>Create the VPC</li></ul><h3 id="create-the-security-group" tabindex="-1"><a class="header-anchor" href="#create-the-security-group"><span>Create the security group</span></a></h3><blockquote><p>This creates your <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--> proxy security group to allow MQTT clients and SSH access.</p></blockquote><p>A VPC security group is needed for the <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--> proxies when they are launched.</p><p>Follow the <a href="https://console.aws.amazon.com/vpcconsole/home#CreateSecurityGroup:" target="_blank" rel="noopener noreferrer">Create Security Group</a> wizard with the following parameters and defaults. This creates your <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--> proxy security group to allow MQTT clients and SSH access.</p><div class="hint-container note"><p class="hint-container-title">Check your selected region</p><p>Make sure you have selected the desired region, ex: <code>US East (N. Virginia) us-east-1</code>.</p></div><ul><li>Name: <code>my-zilla-iot-proxy-sg</code></li><li>VPC: <code>my-zilla-iot-proxy-vpc</code></li><li>Description: <code>MQTT clients and SSH access</code></li><li>Add Inbound Rule <ul><li>Type: <code>CUSTOM TCP</code></li><li>Port Range: <code>8883</code></li><li>Source type: <code>Anywhere-IPv4</code></li></ul></li><li>Add Inbound Rule <ul><li>Type: <code>SSH</code></li><li>Source type: <code>My IP</code></li></ul></li><li>Add Outbound Rule (if not exists) <ul><li>Type: <code>All traffic</code></li><li>Destination: <code>Anywhere-IPv4</code></li></ul></li><li>Create the Security Group</li></ul><div class="hint-container warning"><p class="hint-container-title">Check your network settings</p><p>Your IP may be different when you SSH into the EC2 instance. VPNs and other networking infrastructure may cause the <code>My IP</code> inbound rule to fail. Instead, you can use one of the other ways AWS provides to execute commands in an EC2 instance.</p></div><h3 id="create-the-iam-security-role" tabindex="-1"><a class="header-anchor" href="#create-the-iam-security-role"><span>Create the IAM security role</span></a></h3><blockquote><p>This creates an IAM security role to enable the required AWS services for the <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--> proxies.</p></blockquote><p>Navigate to the <a href="https://console.aws.amazon.com/iamv2/home#/roles/create" target="_blank" rel="noopener noreferrer">Create role</a> form and fill out the form with the following details:</p><ul><li><p>Region: <code>Global</code></p></li><li><p>Trusted Entity Type: <code>AWS Service</code></p></li><li><p>Choose a use case: <code>EC2</code></p></li><li><p>Add Permissions policies</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>AWSCertificateManagerReadOnly</span></span>
<span class="line"><span>AmazonSSMManagedInstanceCore</span></span></code></pre></div></li><li><p>Role Name:</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>my-zilla-iot-role</span></span></code></pre></div></li></ul><p>Click <code>Create role</code></p><p>Open the newly created role</p><ul><li><p>Use the <code>Add permissions</code> &gt; <code>Create Inline Policy</code> action from the dropdown</p></li><li><p>JSON Summary</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">{</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;Version&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;2012-10-17&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;Statement&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: [</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">    {</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">      &quot;Sid&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;VisualEditor0&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">      &quot;Effect&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;Allow&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">      &quot;Action&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: [</span></span>
<span class="line"><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">        &quot;secretsmanager:GetSecretValue&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">        &quot;secretsmanager:DescribeSecret&quot;</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">      ],</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">      &quot;Resource&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: [</span></span>
<span class="line"><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">        &quot;arn:aws:secretsmanager:*:*:secret:&lt;TLS certificate private key secret name&gt;*&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">        &quot;arn:aws:secretsmanager:*:*:secret:&lt;SASL/SCRAM auth secret name&gt;*&quot;</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">      ]</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">    }</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">  ]</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">}</span></span></code></pre></div></li></ul><div class="hint-container info"><p class="hint-container-title">If you used a different secret name.</p><p>The IAM role Inline policy uses the Secrets Manager ARN regex pattern <code>arn:aws:secretsmanager:*:*:secret:&lt;Secret Name&gt;*</code>. Make sure you replace the resources listed with the appropriate patterns.</p></div><ul><li><p>Name</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>MyZillaIotProxySecretsManagerRead</span></span></code></pre></div></li></ul><h2 id="subscribe-via-aws-marketplace" tabindex="-1"><a class="header-anchor" href="#subscribe-via-aws-marketplace"><span>Subscribe via AWS Marketplace</span></a></h2><p>The <a href="https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44" target="_blank" rel="noopener noreferrer">Zilla Plus for Amazon MSK</a>) is available through the AWS Marketplace. You can skip this step if you have already subscribed to Zilla Plus for Amazon MSK via the AWS Marketplace.</p><p>To get started, visit the Proxy&#39;s Marketplace <a href="https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44" target="_blank" rel="noopener noreferrer">Product Page</a> and <code>Subscribe</code> to the offering. You should now see <code>Zilla Plus for Amazon MSK</code> listed in your <a href="https://console.aws.amazon.com/marketplace" target="_blank" rel="noopener noreferrer">AWS Marketplace</a> subscriptions.</p><h2 id="deploy-the-iot-ingest-and-control-mqtt-broker" tabindex="-1"><a class="header-anchor" href="#deploy-the-iot-ingest-and-control-mqtt-broker"><span>Deploy the IoT Ingest and Control MQTT Broker</span></a></h2><blockquote><p>This initiates deployment of the Zilla Plus for Amazon MSK stack via CloudFormation.</p></blockquote><p>Navigate to your <a href="https://console.aws.amazon.com/marketplace" target="_blank" rel="noopener noreferrer">AWS Marketplace</a> subscriptions and select <code>Zilla Plus for Amazon MSK</code> to show the manage subscription page.</p><ul><li>From the <code>Agreement</code> section &gt; <code>Actions</code> menu &gt; select <code>Launch CloudFormation stack</code></li><li>Select the <code>CloudFormation Template</code> &gt; <code>IoT Ingest and Control</code> fulfillment option</li><li>Make sure you have selected the desired region selected, such as <code>us-east-1</code></li><li>Click <code>Continue to Launch</code><ul><li>Choose the action <code>Launch CloudFormation</code></li></ul></li></ul><p>Click <code>Launch</code> to complete the <code>Create stack</code> wizard with the following details:</p><h3 id="step-1-create-stack" tabindex="-1"><a class="header-anchor" href="#step-1-create-stack"><span>Step 1. Create Stack</span></a></h3><ul><li>Prepare template: <code>Template is ready</code></li><li>Specify template: <code>Amazon S3 URL</code><ul><li>Amazon S3 URL: <code>(auto-filled)</code></li></ul></li></ul><h3 id="step-2-specify-stack-details" tabindex="-1"><a class="header-anchor" href="#step-2-specify-stack-details"><span>Step 2. Specify stack details</span></a></h3><div class="vp-code-tabs"><div class="vp-code-tabs-nav" role="tablist"><button type="button" class="vp-code-tab-nav active" role="tab" aria-controls="codetab-524-0" aria-selected="true">Stack name</button></div><!--[--><div class="vp-code-tab active" id="codetab-524-0" role="tabpanel" aria-expanded="true"><div class="vp-code-tab-title">Stack name</div><!--[--><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>my-zilla-iot-proxy</span></span></code></pre></div><!--]--></div><!--]--></div><p>Parameters:</p><ul><li>Network Configuration <ul><li>VPC: <code>my-zilla-iot-proxy-vpc</code></li><li>Subnets: <code>my-zilla-iot-proxy-subnet-public-1a</code> <code>my-zilla-iot-proxy-subnet-public-1b</code></li></ul></li><li>Amazon MSK Configuration <ul><li>Access Credentials Secret ARN: <code>&lt;my-zilla-iot-access-secret secret ARN&gt;</code> *1</li><li>Bootstrap Servers: <code>&lt;my-zilla-iot-msk-cluster bootstrap servers&gt;</code></li><li>Kafka Topics: <ul><li>messages: <code>mqtt-messages</code></li><li>retained: <code>mqtt-retained</code></li><li>sessions: <code>mqtt-sessions</code></li></ul></li></ul></li><li>Zilla Plus Configuration <ul><li>Instance count: <code>2</code></li><li>Instance type: <code>t3.small</code> *2</li><li>Role: <code>my-zilla-iot-role</code></li><li>Security Groups: <code>my-zilla-iot-proxy-sg</code></li><li>Public Port: <code>8883</code></li><li>Public Wildcard DNS: <code>*.example.aklivity.io</code> *3</li><li>Public TLS Certificate Key: <code>&lt;TLS certificate private key secret ARN&gt;</code> *4</li><li>Key pair for SSH access: <code>my-key-pair</code> *5</li></ul></li><li>*Configuration Reference <ol><li>This is the ARN for the secret created in the <a href="#create-a-secret-with-sasl-scram-authentication-params">Create a Secret with SASL/SCRAM authentication params</a> step of this guide.</li><li>Consider the network throughput characteristics of the AWS instance type as that will impact the upper bound on network performance.</li><li>Replace with your own custom wildcard DNS pattern mentioned in the <a href="#prerequisites">Prerequisites</a> of this guide.</li><li>This is the ARN of the created secret for the signed certificate&#39;s private key mentioned in the <a href="#prerequisites">Prerequisites</a> of this guide.</li><li>Follow the <a class="route-link" href="/zilla-docs/next/solutions/how-tos/aws-services/create-key-pair.html">Create Key Pair</a> guide to create a new key pair to access EC2 instances via SSH.</li></ol></li></ul><h3 id="step-3-configure-stack-options-use-defaults" tabindex="-1"><a class="header-anchor" href="#step-3-configure-stack-options-use-defaults"><span>Step 3. Configure stack options: <code>(use defaults)</code></span></a></h3><h3 id="step-4-review" tabindex="-1"><a class="header-anchor" href="#step-4-review"><span>Step 4. Review</span></a></h3><p>Confirm the stack details are correct and <code>Submit</code> to start the CloudFormation deploy.</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>When your <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--> proxy is ready, the <a href="https://console.aws.amazon.com/cloudformation" target="_blank" rel="noopener noreferrer">CloudFormation console</a> will show <code>CREATE_COMPLETE</code> for the newly created stack.</p></div><h3 id="configure-global-dns" tabindex="-1"><a class="header-anchor" href="#configure-global-dns"><span>Configure Global DNS</span></a></h3><blockquote><p>This enables MQTT clients to connect to the <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--> proxy via your custom DNS wildcard domain.</p></blockquote><p>When using a wildcard DNS name for your own domain, such as <code>*.example.aklivity.io</code> then the DNS entries are setup in your DNS provider.</p><p>Navigate to the <a href="https://console.aws.amazon.com/cloudformation" target="_blank" rel="noopener noreferrer">CloudFormation console</a>. Then select the <code>my-zilla-iot-proxy</code> stack to show the details.</p><p>In the stack <code>Outputs</code> tab, find the public DNS name of the <code>NetworkLoadBalancer</code>. You need to create a <code>CNAME</code> record mapping your public DNS wildcard pattern to the public DNS name of the Network Load Balancer.</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>You might prefer to use an Elastic IP address for each NLB public subnet, providing DNS targets for your <code>CNAME</code> record that can remain stable even after restarting the stack.</p><p>For testing purposes you can edit your local <code>/etc/hosts</code> file instead of updating your DNS provider.</p></div><h2 id="verify-mqtt-client-connectivity" tabindex="-1"><a class="header-anchor" href="#verify-mqtt-client-connectivity"><span>Verify MQTT Client Connectivity</span></a></h2><p>We need to verify that an MQTT client can publish and subscribe to topics and ensure the messages get routed through your Kafka cluster.</p><h3 id="connect-with-an-mqtt-client" tabindex="-1"><a class="header-anchor" href="#connect-with-an-mqtt-client"><span>Connect with an MQTT Client</span></a></h3><blockquote><p>This verifies MQTT client connectivity to your Kafka cluster via the IoT Ingest and Control MQTT Broker.</p></blockquote><p>We can now verify that the MQTT client can successfully communicate with your Kafka cluster.</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Replace these TLS server names accordingly for your own custom wildcard DNS pattern.</p></div><h3 id="subscribe-to-a-topic" tabindex="-1"><a class="header-anchor" href="#subscribe-to-a-topic"><span>Subscribe to a topic</span></a></h3><p>Using <a href="https://hub.docker.com/_/eclipse-mosquitto" target="_blank" rel="noopener noreferrer">eclipse-mosquitto</a> subscribe to the <code>zilla</code> topic.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">docker</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> run</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -it</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --rm</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> eclipse-mosquitto</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">mosquitto_sub </span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">--url</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> mqtts://mqtt.example.aklivity.io/zilla</span></span></code></pre></div><h3 id="publish-to-a-topic" tabindex="-1"><a class="header-anchor" href="#publish-to-a-topic"><span>Publish to a topic</span></a></h3><p>In a separate session, publish a message on the <code>zilla</code> topic.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">docker</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> run</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -it</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --rm</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> eclipse-mosquitto</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">mosquitto_pub </span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">--url</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> mqtts://mqtt.example.aklivity.io/zilla</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --message</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &#39;Hello, world&#39;</span></span></code></pre></div><p>You should see the <code>Hello, world</code> message printed by the subscriber.</p><h2 id="verify-the-zilla-proxy-service" tabindex="-1"><a class="header-anchor" href="#verify-the-zilla-proxy-service"><span>Verify the Zilla proxy Service</span></a></h2><blockquote><p>This checks that the services and networking were properly configured. These checks aren&#39;t necessary if the service is running as expected.</p></blockquote><p>Navigate to the <a href="https://console.aws.amazon.com/ec2/home#Instances:instanceState=running" target="_blank" rel="noopener noreferrer">EC2 running instances dashboard.</a></p><div class="hint-container note"><p class="hint-container-title">Check your selected region</p><p>Make sure you have selected the desired region, ex: <code>US East (N. Virginia) us-east-1</code>.</p></div><p>Select either of the <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--> proxies launched by the CloudFormation template to show the details.</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>They each have an IAM Role name starting with <code>my-zilla-iot-role</code>.</p></div><p>Find the <code>Public IPv4 Address</code> and then SSH into the instance.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">ssh</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -i</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> ~/.ssh/</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">key-pair.ce</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">r&gt; </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">ec2-user@</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">instance-public-ip-addres</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">s&gt;</span></span></code></pre></div><p>After logging in via SSH, check the status of the <code>zilla-plus</code> system service.</p><div class="vp-tabs"><div class="vp-tabs-nav" role="tablist"><button type="button" class="vp-tab-nav active" role="tab" aria-controls="tab-785-0" aria-selected="true">Service is running</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-785-1" aria-selected="false">Check Ports</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-785-2" aria-selected="false">Check Zilla Logs</button><button type="button" class="vp-tab-nav" role="tab" aria-controls="tab-785-3" aria-selected="false">Check Cloud Init Logs</button></div><!--[--><div class="vp-tab active" id="tab-785-0" role="tabpanel" aria-expanded="true"><div class="vp-tab-title">Service is running</div><!--[--><p>Verify that the <code>zilla-plus</code> service is active and logging output similar to that shown below.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">systemctl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> status</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla-plus.service</span></span></code></pre></div><div class="language-output" data-highlighter="shiki" data-ext="output" data-title="output" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>zilla-plus.service - Zilla Plus</span></span>
<span class="line"><span>   Loaded: loaded (/etc/systemd/system/zilla-plus.service; enabled; vendor preset: disabled)</span></span>
<span class="line"><span>   Active: active (running) since...</span></span></code></pre></div><!--]--></div><div class="vp-tab" id="tab-785-1" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">Check Ports</div><!--[--><p>Check for the active ports with <code>netstat</code>.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">netstat</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -ntlp</span></span></code></pre></div><div class="language-output" data-highlighter="shiki" data-ext="output" data-title="output" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>tcp6    0    0 :::9092    :::*    LISTEN    1726/.zpm/image/bin</span></span></code></pre></div><!--]--></div><div class="vp-tab" id="tab-785-2" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">Check Zilla Logs</div><!--[--><p>You can get an stdout dump of the <code>zilla-plus.service</code> using <code>journalctl</code>.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">journalctl</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -e</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -u</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla-plus.service</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> | </span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">tee</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -a</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> /tmp/zilla.log</span></span></code></pre></div><div class="language-output" data-highlighter="shiki" data-ext="output" data-title="output" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>systemd[1]: Started zilla-plus.service - Zilla Plus.</span></span>
<span class="line"><span>...</span></span></code></pre></div><!--]--></div><div class="vp-tab" id="tab-785-3" role="tabpanel" aria-expanded="false"><div class="vp-tab-title">Check Cloud Init Logs</div><!--[--><p>All output from cloud-init is captured by default to <code>/var/log/cloud-init-output.log</code>. There shouldn&#39;t be any errors in this log.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">cat</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> /var/log/cloud-init-output.log</span></span></code></pre></div><div class="language-output" data-highlighter="shiki" data-ext="output" data-title="output" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>Cloud-init v. 22.2.2 running &#39;init&#39;...</span></span></code></pre></div><!--]--></div><!--]--></div><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2><p>You have successfully deployed the <a href="https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44" target="_blank" rel="noopener noreferrer">Zilla Plus for Amazon MSK</a> IoT Ingest and Control MQTT Broker. Instructions on how to Monitor and Upgrade your <!--[--> Zilla<sup><span class="font-icon icon fa fa-plus" style=""></span></sup><!--]--> proxy can be found in the <a class="route-link" href="/zilla-docs/next/solutions/how-tos/aws-services/manage-cloudformation-stack.html">managing a cloudformation stack</a> section.</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/aklivity/zilla-docs/edit/develop/src/solutions/how-tos/amazon-msk/iot-ingest-control.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/zilla-docs/next/solutions/concepts/kafka-proxies/iot-ingest-control.html" aria-label="Deployment Options"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->Deployment Options</div></a><a class="route-link auto-link next" href="/zilla-docs/next/solutions/how-tos/confluent-cloud/iot-ingest-control.html" aria-label="Confluent Cloud"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Confluent Cloud<!----></div></a></nav><!----><!----><!--]--></main><!--]--><!--]--><footer class="vp-footer-wrapper" vp-footer><div class="vp-footer"><span style="display:flex;align-items:center"><a href="https://www.aklivity.io"><img class="logo" alt="aklivity"></a> <a href="https://github.com/aklivity/zilla"><i class="fa-brands fa-github" style="font-size:22px;padding-right:6px"></i></a> <a href="https://www.linkedin.com/company/aklivity/"><i class="fa-brands fa-linkedin" style="font-size:22px;padding-right:6px"></i></a> <a href="https://www.aklivity.io/slack"><i class="fa-brands fa-slack" style="font-size:25px;padding-right:6px"></i></a> <a href="https://www.twitter.com/aklivityinc"><i class="fa-brands fa-twitter" style="font-size:22px"></i></a></span></div><div class="vp-copyright">© aklivity, inc. 2023-2024</div></footer></div><!--]--><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/zilla-docs/next/assets/app-DWA4uJ8g.js" defer></script>
  </body>
</html>
