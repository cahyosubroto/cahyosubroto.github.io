import{_ as k}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c,a as i,b as t,d as s,f as o,e as l,r as p,o as g}from"./app-CpLUooG5.js";const y={},m={class:"zilla-plus-badge hint-container info"},f={href:"https://www.aklivity.io/products/zilla-plus",target:"_blank",rel:"noopener noreferrer"},v={class:"hint-container tip"},b={id:"create-the-proxy-security-group",tabindex:"-1"},D={class:"header-anchor",href:"#create-the-proxy-security-group"},C={id:"create-the-proxy-iam-security-role",tabindex:"-1"},F={class:"header-anchor",href:"#create-the-proxy-iam-security-role"},A={class:"hint-container info"},w={id:"verify-proxy-service",tabindex:"-1"},S={class:"header-anchor",href:"#verify-proxy-service"},E={class:"hint-container tip"},x={class:"hint-container tip"};function z(T,e){const a=p("ZillaPlus"),d=p("RouteLink"),h=p("CodeTabs"),u=p("Tabs");return g(),c("div",null,[e[150]||(e[150]=i("h1",{id:"amazon-msk-mutual-tls-authentication",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#amazon-msk-mutual-tls-authentication"},[i("span",null,"Amazon MSK Mutual TLS authentication")])],-1)),i("p",m,[i("a",f,[e[0]||(e[0]=t("Available in ")),s(a)])]),e[151]||(e[151]=o('<div class="hint-container info"><p class="hint-container-title">Estimated time to complete 20-30 minutes.</p></div><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h2><p>The <a href="https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44" target="_blank" rel="noopener noreferrer">Zilla Plus for Amazon MSK</a> Secure Public Access proxy lets authorized Kafka clients connect, publish messages and subscribe to topics in your Amazon MSK cluster via the internet.</p><p>In this guide we will deploy the Zilla Plus for Amazon MSK Secure Public Access proxy and showcase globally trusted public internet connectivity to an MSK cluster from a Kafka client, using the custom wildcard domain <code>*.example.aklivity.io</code>. Kafka clients will use TLS client certificates to verify trusted client identity.</p><h3 id="aws-services-used" tabindex="-1"><a class="header-anchor" href="#aws-services-used"><span>AWS services used</span></a></h3><table><thead><tr><th>Service</th><th>Required</th><th>Usage</th><th>Quota</th></tr></thead><tbody><tr><td>Resource Groups and Tagging</td><td>Yes</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/arg.html#arg-quotas" target="_blank" rel="noopener noreferrer">None</a></td></tr><tr><td>Secrets Manager</td><td>Yes</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/asm.html#limits_secrets-manager" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr><tr><td>Certificate Manager</td><td>No<br><br>Private key and certificate can be inline in Secrets Manager instead</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/acm.html#limits_acm" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr><tr><td>Private Certificate Manager</td><td>No<br><br>Private key and certificate can be inline in Secrets Manager instead</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/acm-pca.html#limits_acm-pca" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr></tbody></table><p>Default <a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html" target="_blank" rel="noopener noreferrer">AWS Service Quotas</a> are recommended.</p><h2 id="prerequisites" tabindex="-1"><a class="header-anchor" href="#prerequisites"><span>Prerequisites</span></a></h2><p>Before setting up internet access to your MSK Cluster, you will need the following:</p>',9)),i("ul",null,[e[5]||(e[5]=i("li",null,"an MSK Cluster configured for TLS encrypted client access and TLS client authentication",-1)),i("li",null,[e[1]||(e[1]=t("an VPC security group for ")),s(a),e[2]||(e[2]=t(" proxies"))]),i("li",null,[e[3]||(e[3]=t("an IAM security role for ")),s(a),e[4]||(e[4]=t(" proxies"))]),e[6]||(e[6]=i("li",null,"subscription to Zilla Plus for Amazon MSK via AWS Marketplace",-1)),e[7]||(e[7]=i("li",null,"permission to modify global DNS records for a custom domain",-1)),e[8]||(e[8]=i("li",null,"permission to generate client certificates signed by a private certificate authority",-1))]),i("div",v,[e[12]||(e[12]=i("p",{class:"hint-container-title"},"Tips",-1)),i("p",null,[e[10]||(e[10]=t("Check out the ")),s(d,{to:"/solutions/how-tos/aws-services/troubleshooting.html"},{default:l(()=>e[9]||(e[9]=[t("Troubleshooting")])),_:1}),e[11]||(e[11]=t(" guide if you run into any issues."))])]),e[152]||(e[152]=i("h3",{id:"create-certificate-authority-for-mtls",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#create-certificate-authority-for-mtls"},[i("span",null,"Create Certificate Authority for mTLS")])],-1)),e[153]||(e[153]=i("blockquote",null,[i("p",null,"This creates a new private certificate authority in ACM.")],-1)),i("p",null,[e[14]||(e[14]=t("Follow the ")),s(d,{to:"/solutions/how-tos/aws-services/create-certificate-authority-acm.html"},{default:l(()=>e[13]||(e[13]=[t("Create Certificate Authority")])),_:1}),e[15]||(e[15]=t(" to create a private certificate authority to verify TLS client authentication."))]),i("ul",null,[i("li",null,[e[18]||(e[18]=t("Distinguished Name")),s(h,{id:"158",data:[{id:"Common Name (CN)"}]},{title0:l(({value:n,isActive:r})=>e[16]||(e[16]=[t("Common Name (CN)")])),tab0:l(({value:n,isActive:r})=>e[17]||(e[17]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"Mutual Authentication CA")])])])],-1)])),_:1})])]),e[154]||(e[154]=i("h3",{id:"create-the-msk-cluster",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#create-the-msk-cluster"},[i("span",null,"Create the MSK Cluster")])],-1)),e[155]||(e[155]=i("blockquote",null,[i("p",null,"This creates your MSK cluster in preparation for secure access via the internet.")],-1)),e[156]||(e[156]=i("p",null,"An MSK cluster is needed for secure remote access via the internet. You can skip this step if you have already created an MSK cluster with equivalent configuration.",-1)),i("p",null,[e[20]||(e[20]=t("Follow the ")),s(d,{to:"/solutions/how-tos/aws-services/create-msk-cluster.html"},{default:l(()=>e[19]||(e[19]=[t("Create MSK Cluster")])),_:1}),e[21]||(e[21]=t(" guide to setup the a new MSK cluster. We will use the below resource names to reference the AWS resources needed in this guide."))]),e[157]||(e[157]=o('<ul><li>Cluster Name: <code>my-msk-cluster</code></li><li>Access control methods: <code>TLS client certificates</code></li><li>AWS Private CAs: <code>Mutual Authentication CA</code></li><li>VPC: <code>my-msk-cluster-vpc</code></li><li>Subnet: <code>my-msk-cluster-subnet-*</code></li><li>Route tables: <code>my-msk-cluster-rtb-*</code></li><li>Internet gateway: <code>my-msk-cluster-igw</code></li></ul><h4 id="create-client-certificate-for-mtls" tabindex="-1"><a class="header-anchor" href="#create-client-certificate-for-mtls"><span>Create Client Certificate for mTLS</span></a></h4>',2)),i("p",null,[e[23]||(e[23]=t("This allows an authorized Kafka client to connect directly to your MSK cluster with Mutual TLS (mTLS). Follow the ")),s(d,{to:"/solutions/how-tos/aws-services/create-client-certificate-acm.html"},{default:l(()=>e[22]||(e[22]=[t("Create Client Certificate")])),_:1}),e[24]||(e[24]=t(" to create a private certificate authority."))]),i("p",null,[e[25]||(e[25]=t("You can create additional client certificates for each different authorized client identity that will connect via the internet to your ")),s(a),e[26]||(e[26]=t(" proxy deployment."))]),e[158]||(e[158]=i("p",null,[i("a",{href:"https://docs.aws.amazon.com/msk/latest/developerguide/msk-update-security.html",target:"_blank",rel:"noopener noreferrer"},"Update the security settings"),t(" of your MSK cluster. Update your Access control methods to include")],-1)),e[159]||(e[159]=i("p",null,[t("Common Name: "),i("code",null,"client-1"),i("br"),t(" Private Certificate Authority: "),i("code",null,"Mutual Authentication CA")],-1)),i("h3",b,[i("a",D,[i("span",null,[e[27]||(e[27]=t("Create the ")),s(a),e[28]||(e[28]=t(" proxy security group"))])])]),i("blockquote",null,[i("p",null,[e[29]||(e[29]=t("This creates your ")),s(a),e[30]||(e[30]=t(" proxy security group to allow Kafka clients and SSH access."))])]),i("p",null,[e[31]||(e[31]=t("A VPC security group is needed for the ")),s(a),e[32]||(e[32]=t(" proxies when they are launched."))]),i("p",null,[e[33]||(e[33]=t("Follow the ")),e[34]||(e[34]=i("a",{href:"https://console.aws.amazon.com/vpcconsole/home#CreateSecurityGroup:",target:"_blank",rel:"noopener noreferrer"},"Create Security Group",-1)),e[35]||(e[35]=t(" wizard with the following parameters and defaults. This creates your ")),s(a),e[36]||(e[36]=t(" proxy security group to allow Kafka clients and SSH access."))]),e[160]||(e[160]=o('<ul><li>VPC: <code>my-msk-cluster-vpc</code></li><li>Name: <code>my-zilla-proxy-sg</code></li><li>Description: <code>Kafka clients and SSH access</code></li><li>Add Inbound Rule <ul><li>Type: <code>CUSTOM TCP</code></li><li>Port Range: <code>9094</code></li><li>Source type: <code>Anywhere-IPv4</code></li></ul></li><li>Add Inbound Rule <ul><li>Type: <code>SSH</code></li><li>Source type: <code>My IP</code></li></ul></li><li>Add Outbound Rule (if not exists) <ul><li>Type: <code>All traffic</code></li><li>Destination: <code>Anywhere-IPv4</code></li></ul></li><li>Create the Security Group</li></ul><div class="hint-container warning"><p class="hint-container-title">Check your network settings</p><p>Your IP may be different when you SSH into the EC2 instance. VPNs and other networking infrastructure may cause the <code>My IP</code> inbound rule to fail. Instead, you can use one of the other ways AWS provides to execute commands in an EC2 instance.</p></div><h3 id="update-the-default-security-group-rules" tabindex="-1"><a class="header-anchor" href="#update-the-default-security-group-rules"><span>Update the default security group rules</span></a></h3>',3)),i("blockquote",null,[i("p",null,[e[37]||(e[37]=t("This allows the ")),s(a),e[38]||(e[38]=t(" proxies to communicate with your MSK cluster."))])]),e[161]||(e[161]=o('<p>Navigate to the VPC Management Console <a href="https://console.aws.amazon.com/vpc/home#securityGroups:" target="_blank" rel="noopener noreferrer">Security Groups</a> table.</p><div class="hint-container note"><p class="hint-container-title">Check your selected region</p><p>Make sure you have selected the desired region, ex: <code>US East (N. Virginia) us-east-1</code>.</p></div><p>Filter the security groups by selecting a <code>VPC</code> and select the <code>default</code> security group.</p><ul><li>VPC: <code>my-msk-cluster-vpc</code></li><li>Security Group: <code>default</code></li></ul><h4 id="add-a-custom-tcp-rule" tabindex="-1"><a class="header-anchor" href="#add-a-custom-tcp-rule"><span>Add a Custom TCP Rule</span></a></h4>',5)),i("p",null,[e[39]||(e[39]=t("Add this Inbound Rule to allow the ")),s(a),e[40]||(e[40]=t(" proxies to communicate with the MSK cluster."))]),e[162]||(e[162]=i("ul",null,[i("li",null,[t("Type: "),i("code",null,"Custom TCP")]),i("li",null,[t("Port Range: "),i("code",null,"9094")]),i("li",null,[t("Source type: "),i("code",null,"Custom")]),i("li",null,[t("Source: "),i("code",null,"my-zilla-proxy-sg")])],-1)),i("h3",C,[i("a",F,[i("span",null,[e[41]||(e[41]=t("Create the ")),s(a),e[42]||(e[42]=t(" proxy IAM security role"))])])]),i("blockquote",null,[i("p",null,[e[43]||(e[43]=t("This creates an IAM security role to enable the required AWS services for the ")),s(a),e[44]||(e[44]=t(" proxies."))])]),i("p",null,[e[46]||(e[46]=t("Follow the ")),s(d,{to:"/solutions/how-tos/aws-services/create-iam-role.html"},{default:l(()=>e[45]||(e[45]=[t("Create IAM Role")])),_:1}),e[47]||(e[47]=t(" guide to create an IAM security role with the following parameters:"))]),s(h,{id:"398",data:[{id:"Name"},{id:"Policies"}]},{title0:l(({value:n,isActive:r})=>e[48]||(e[48]=[t("Name")])),title1:l(({value:n,isActive:r})=>e[49]||(e[49]=[t("Policies")])),tab0:l(({value:n,isActive:r})=>e[50]||(e[50]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"aklivity-zilla-proxy")])])])],-1)])),tab1:l(({value:n,isActive:r})=>e[51]||(e[51]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"AWSCertificateManagerReadOnly")]),t(`
`),i("span",{class:"line"},[i("span",null,"AWSCertificateManagerPrivateCAReadOnly")]),t(`
`),i("span",{class:"line"},[i("span",null,"ResourceGroupsandTagEditorReadOnlyAccess")]),t(`
`),i("span",{class:"line"},[i("span",null,"AmazonSSMManagedInstanceCore")])])])],-1)])),_:1}),e[163]||(e[163]=i("h4",{id:"iam-role-inline-policies",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#iam-role-inline-policies"},[i("span",null,"IAM role Inline Policies")])],-1)),i("p",null,[e[52]||(e[52]=t("This creates an IAM security role to enable the required AWS services for the ")),s(a),e[53]||(e[53]=t(" proxies."))]),s(h,{id:"412",data:[{id:"Name"},{id:"JSON Summary"}]},{title0:l(({value:n,isActive:r})=>e[54]||(e[54]=[t("Name")])),title1:l(({value:n,isActive:r})=>e[55]||(e[55]=[t("JSON Summary")])),tab0:l(({value:n,isActive:r})=>e[56]||(e[56]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"MSKProxySecretsManagerRead")])])])],-1)])),tab1:l(({value:n,isActive:r})=>e[57]||(e[57]=[i("div",{class:"language-json","data-highlighter":"shiki","data-ext":"json","data-title":"json",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"{")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'  "Version"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'"2012-10-17"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'  "Statement"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": [")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"    {")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'      "Sid"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'"VisualEditor0"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'      "Effect"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'"Allow"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'      "Action"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": [")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "acm-pca:GetCertificate"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "acm-pca:GetCertificateAuthorityCertificate"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "acm-pca:DescribeCertificateAuthority"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "tag:GetResources"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "secretsmanager:GetSecretValue"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "secretsmanager:DescribeSecret"')]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"      ],")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'      "Resource"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": [")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "arn:aws:secretsmanager:*:*:secret:wildcard.example.aklivity.io*"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "arn:aws:secretsmanager:*:*:secret:client-*"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "arn:aws:acm-pca:*:*:certificate-authority*"')]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"      ]")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"    }")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"  ]")]),t(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"}")])])])],-1)])),_:1}),e[164]||(e[164]=o('<div class="hint-container info"><p class="hint-container-title">If you used a different names for your certificate resources.</p><p>This example pattern uses resources with names including <code>wildcard.example.aklivity.io</code>, <code>client-</code>, <code>certificate-authority</code> etc. Replace them with the names you used or use wildcard resource selectors.</p></div><h2 id="subscribe-via-aws-marketplace" tabindex="-1"><a class="header-anchor" href="#subscribe-via-aws-marketplace"><span>Subscribe via AWS Marketplace</span></a></h2><p>The <a href="https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44" target="_blank" rel="noopener noreferrer">Zilla Plus for Amazon MSK</a> is available through the AWS Marketplace. You can skip this step if you have already subscribed to Zilla Plus for Amazon MSK via AWS Marketplace.</p><p>To get started, visit the Proxy&#39;s Marketplace <a href="https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44" target="_blank" rel="noopener noreferrer">Product Page</a> and <code>Subscribe</code> to the offering. You should now see <code>Zilla Plus for Amazon MSK</code> listed in your <a href="https://console.aws.amazon.com/marketplace" target="_blank" rel="noopener noreferrer">AWS Marketplace</a> subscriptions.</p><h2 id="create-the-public-tls-server-certificate" tabindex="-1"><a class="header-anchor" href="#create-the-public-tls-server-certificate"><span>Create the Public TLS Server Certificate</span></a></h2><p>We need a Public TLS Server Certificate for your custom DNS wildcard domain that can be trusted by a Kafka Client from anywhere.</p>',6)),i("p",null,[e[59]||(e[59]=t("Follow the ")),s(d,{to:"/solutions/how-tos/aws-services/create-server-certificate-letsencrypt.html"},{default:l(()=>e[58]||(e[58]=[t("Create Server Certificate (LetsEncrypt)")])),_:1}),e[60]||(e[60]=t(" guide to create a new TLS Server Certificate. Use your own custom wildcard DNS domain in place of the example wildcard domain ")),e[61]||(e[61]=i("code",null,"*.example.aklivity.io",-1)),e[62]||(e[62]=t("."))]),e[165]||(e[165]=o('<div class="hint-container info"><p class="hint-container-title">Info</p><p>Note the server certificate secret ARN as we will need to reference it from the Secure Public Access CloudFormation template.</p></div><h2 id="deploy-the-zilla-plus-secure-public-access-proxy" tabindex="-1"><a class="header-anchor" href="#deploy-the-zilla-plus-secure-public-access-proxy"><span>Deploy the Zilla Plus Secure Public Access Proxy</span></a></h2><blockquote><p>This initiates deployment of the Zilla Plus for Amazon MSK stack via CloudFormation.</p></blockquote><p>Navigate to your <a href="https://console.aws.amazon.com/marketplace" target="_blank" rel="noopener noreferrer">AWS Marketplace</a> subscriptions and select <code>Zilla Plus for Amazon MSK</code> to show the manage subscription page.</p><ul><li>From the <code>Agreement</code> section &gt; <code>Actions</code> menu &gt; select <code>Launch CloudFormation stack</code></li><li>Select the <code>Secure Public Access (mTLS)</code> fulfillment option</li><li>Make sure you have selected the desired region selected, such as <code>us-east-1</code></li><li>Click <code>Continue to Launch</code><ul><li>Choose the action <code>Launch CloudFormation</code></li></ul></li></ul><p>Click <code>Launch</code> to complete the <code>Create stack</code> wizard with the following details:</p><h3 id="step-1-create-stack" tabindex="-1"><a class="header-anchor" href="#step-1-create-stack"><span>Step 1. Create Stack</span></a></h3><ul><li>Prepare template: <code>Template is ready</code></li><li>Specify template: <code>Amazon S3 URL</code><ul><li>Amazon S3 URL: <code>(auto-filled)</code></li></ul></li></ul><h3 id="step-2-specify-stack-details" tabindex="-1"><a class="header-anchor" href="#step-2-specify-stack-details"><span>Step 2. Specify stack details</span></a></h3>',9)),s(h,{id:"516",data:[{id:"Stack name"}]},{title0:l(({value:n,isActive:r})=>e[63]||(e[63]=[t("Stack name")])),tab0:l(({value:n,isActive:r})=>e[64]||(e[64]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"my-zilla-proxy")])])])],-1)])),_:1}),e[166]||(e[166]=i("p",null,"Parameters:",-1)),i("ul",null,[e[76]||(e[76]=o("<li>Network Configuration <ul><li>VPC: <code>my-msk-cluster-vpc</code></li><li>Subnets: <code>my-msk-cluster-1a</code> <code>my-msk-cluster-1b</code> <code>my-msk-cluster-1c</code></li></ul></li><li>MSK Configuration <ul><li>Wildcard DNS pattern: <code>*.aklivity.[...].amazonaws.com</code> *1</li><li>Port number: <code>9094</code></li><li>Private Certificate Authority: <code>&lt;private certificate authority ARN&gt;</code> *2</li></ul></li><li>Secure Public Access Configuration <ul><li>Instance count: <code>2</code></li><li>Instance type: <code>t3.small</code> *3</li><li>Role: <code>aklivity-zilla-proxy</code></li><li>Security Groups: <code>my-zilla-proxy</code></li><li>Secrets Manager Secret ARN: <code>&lt;TLS certificate private key secret ARN&gt;</code> *3</li><li>Public Wildcard DNS: <code>*.example.aklivity.io</code> *4</li><li>Public Port: <code>9094</code></li><li>Public Certificate Authority: <code>&lt;private certificate authority ARN&gt;</code> *2</li><li>Key pair for SSH access: <code>my-key-pair</code> *5</li></ul></li>",3)),i("li",null,[e[75]||(e[75]=t("*Configuration Reference ")),i("ol",null,[i("li",null,[e[66]||(e[66]=t("Follow the ")),s(d,{to:"/solutions/how-tos/aws-services/lookup-msk-server-names.html"},{default:l(()=>e[65]||(e[65]=[t("Lookup MSK Server Names")])),_:1}),e[67]||(e[67]=t(" guide to discover the wildcard DNS pattern for your MSK cluster."))]),i("li",null,[e[68]||(e[68]=t("These can be the same Private Certificate Authority that authorizes existing clients connecting directly to MSK, allowing existing trusted client certificates to connect via ")),s(a),e[69]||(e[69]=t(" proxy."))]),e[73]||(e[73]=i("li",null,"Consider the network throughput characteristics of the AWS instance type as that will impact the upper bound on network performance.",-1)),e[74]||(e[74]=i("li",null,"Replace with your own custom wildcard DNS pattern.",-1)),i("li",null,[e[71]||(e[71]=t("Follow the ")),s(d,{to:"/solutions/how-tos/aws-services/create-key-pair.html"},{default:l(()=>e[70]||(e[70]=[t("Create Key Pair")])),_:1}),e[72]||(e[72]=t(" guide to create a new key pair used when launching EC2 instances with SSH access."))])])])]),e[167]||(e[167]=i("h3",{id:"step-3-configure-stack-options-use-defaults",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#step-3-configure-stack-options-use-defaults"},[i("span",null,[t("Step 3. Configure stack options: "),i("code",null,"(use defaults)")])])],-1)),e[168]||(e[168]=i("h3",{id:"step-4-review",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#step-4-review"},[i("span",null,"Step 4. Review")])],-1)),e[169]||(e[169]=i("p",null,[t("Confirm the stack details are correct and "),i("code",null,"Submit"),t(" to start the CloudFormation deploy.")],-1)),i("div",A,[e[83]||(e[83]=i("p",{class:"hint-container-title"},"Info",-1)),i("p",null,[e[77]||(e[77]=t("When your ")),s(a),e[78]||(e[78]=t(" proxy is ready, the ")),e[79]||(e[79]=i("a",{href:"https://console.aws.amazon.com/cloudformation",target:"_blank",rel:"noopener noreferrer"},"CloudFormation console",-1)),e[80]||(e[80]=t(" will show ")),e[81]||(e[81]=i("code",null,"CREATE_COMPLETE",-1)),e[82]||(e[82]=t(" for the newly created stack."))])]),i("h2",w,[i("a",S,[i("span",null,[e[84]||(e[84]=t("Verify ")),s(a),e[85]||(e[85]=t(" proxy Service"))])])]),e[170]||(e[170]=i("blockquote",null,[i("p",null,"This checks that the services and networking were properly configured.")],-1)),e[171]||(e[171]=i("p",null,[t("Navigate to the "),i("a",{href:"https://console.aws.amazon.com/ec2/home#Instances:instanceState=running",target:"_blank",rel:"noopener noreferrer"},"EC2 running instances dashboard.")],-1)),e[172]||(e[172]=i("div",{class:"hint-container note"},[i("p",{class:"hint-container-title"},"Check your selected region"),i("p",null,[t("Make sure you have selected the desired region, ex: "),i("code",null,"US East (N. Virginia) us-east-1"),t(".")])],-1)),i("p",null,[e[86]||(e[86]=t("Select either of the ")),s(a),e[87]||(e[87]=t(" proxies launched by the CloudFormation template to show the details."))]),e[173]||(e[173]=o('<div class="hint-container info"><p class="hint-container-title">Info</p><p>They each have an IAM Role name starting with <code>aklivity-zilla-proxy</code>.</p></div><p>Find the <code>Public IPv4 Address</code> and then SSH into the instance.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">ssh</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -i</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> ~/.ssh/</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">key-pair.ce</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">r&gt; </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">ec2-user@</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">instance-public-ip-addres</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">s&gt;</span></span></code></pre></div><p>After logging in via SSH, check the status of the <code>zilla-plus</code> system service.</p>',4)),s(u,{id:"694",data:[{id:"Service is running"},{id:"Check Ports"},{id:"Check Zilla Logs"},{id:"Check Cloud Init Logs"}]},{title0:l(({value:n,isActive:r})=>e[88]||(e[88]=[t("Service is running")])),title1:l(({value:n,isActive:r})=>e[89]||(e[89]=[t("Check Ports")])),title2:l(({value:n,isActive:r})=>e[90]||(e[90]=[t("Check Zilla Logs")])),title3:l(({value:n,isActive:r})=>e[91]||(e[91]=[t("Check Cloud Init Logs")])),tab0:l(({value:n,isActive:r})=>e[92]||(e[92]=[i("p",null,[t("Verify that the "),i("code",null,"zilla-plus"),t(" service is active and logging output similar to that shown below.")],-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"systemctl"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," status"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," zilla-plus.service")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"zilla-plus.service - Zilla Plus")]),t(`
`),i("span",{class:"line"},[i("span",null,"   Loaded: loaded (/etc/systemd/system/zilla-plus.service; enabled; vendor preset: disabled)")]),t(`
`),i("span",{class:"line"},[i("span",null,"   Active: active (running) since...")])])])],-1)])),tab1:l(({value:n,isActive:r})=>e[93]||(e[93]=[i("p",null,[t("Check for the active ports with "),i("code",null,"netstat"),t(".")],-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"netstat"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -ntlp")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"tcp6    0    0 :::9092    :::*    LISTEN    1726/.zpm/image/bin")])])])],-1)])),tab2:l(({value:n,isActive:r})=>e[94]||(e[94]=[i("p",null,[t("You can get an stdout dump of the "),i("code",null,"zilla-plus.service"),t(" using "),i("code",null,"journalctl"),t(".")],-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"journalctl"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -e"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -u"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," zilla-plus.service"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}}," | "),i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"tee"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -a"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," /tmp/zilla.log")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"systemd[1]: Started zilla-plus.service - Zilla Plus.")]),t(`
`),i("span",{class:"line"},[i("span",null,"...")])])])],-1)])),tab3:l(({value:n,isActive:r})=>e[95]||(e[95]=[i("p",null,[t("All output from cloud-init is captured by default to "),i("code",null,"/var/log/cloud-init-output.log"),t(". There shouldn't be any errors in this log.")],-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"cat"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," /var/log/cloud-init-output.log")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"Cloud-init v. 22.2.2 running 'init'...")])])])],-1)])),_:1}),i("p",null,[e[96]||(e[96]=t("Check the networking of the ")),s(a),e[97]||(e[97]=t(" proxy instances to MSK."))]),s(u,{id:"727",data:[{id:"DNS resolving"},{id:"Check Ports"}]},{title0:l(({value:n,isActive:r})=>e[98]||(e[98]=[t("DNS resolving")])),title1:l(({value:n,isActive:r})=>e[99]||(e[99]=[t("Check Ports")])),tab0:l(({value:n,isActive:r})=>e[100]||(e[100]=[i("p",null,"Verify that the instance can resolve the private Route53 DNS address.",-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"nslookup"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," *"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},".aklivity.[...].amazonaws.com")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"Server:		***")]),t(`
`),i("span",{class:"line"},[i("span",null,"Address:	***")]),t(`
`),i("span",{class:"line"},[i("span")]),t(`
`),i("span",{class:"line"},[i("span",null,"Non-authoritative answer:")]),t(`
`),i("span",{class:"line"},[i("span",null,"Name:	*.aklivity.[...].amazonaws.com")]),t(`
`),i("span",{class:"line"},[i("span",null,"Address: ***")])])])],-1)])),tab1:l(({value:n,isActive:r})=>e[101]||(e[101]=[i("p",null,[t("Check the communication over necessary ports with "),i("code",null,"netcat"),t(".")],-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"nc"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -vz"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," *"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},".aklivity.[...].amazonaws.com"),i("span",{style:{"--shiki-light":"#098658","--shiki-dark":"#B5CEA8"}}," 9094")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"Connection to *.aklivity.[...].amazonaws.com port 9094 [tcp/italk] succeeded!")])])])],-1)])),_:1}),i("p",null,[e[102]||(e[102]=t("Repeat these steps for each of the other ")),s(a),e[103]||(e[103]=t(" proxies launched by the CloudFormation template if necessary."))]),e[174]||(e[174]=i("h3",{id:"configure-global-dns",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#configure-global-dns"},[i("span",null,"Configure Global DNS")])],-1)),i("blockquote",null,[i("p",null,[e[104]||(e[104]=t("This ensures that any new Kafka brokers added to the cluster can still be reached via the ")),s(a),e[105]||(e[105]=t(" proxy."))])]),e[175]||(e[175]=o(`<p>When using a wildcard DNS name for your own domain, such as <code>*.example.aklivity.io</code> then the DNS entries are setup in your DNS provider.</p><p>Navigate to the <a href="https://console.aws.amazon.com/cloudformation" target="_blank" rel="noopener noreferrer">CloudFormation console</a>. Then select the <code>my-zilla-proxy</code> stack to show the details.</p><p>In the stack <code>Outputs</code> tab, find the public DNS name of the <code>NetworkLoadBalancer</code>. You need to create a <code>CNAME</code> record mapping your public DNS wildcard pattern to the public DNS name of the Network Load Balancer.</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>You might prefer to use an Elastic IP address for each NLB public subnet, providing DNS targets for your <code>CNAME</code> record that can remain stable even after restarting the stack.</p><p>For testing purposes you can edit your local <code>/etc/hosts</code> file instead of updating your DNS provider.</p></div><h2 id="verify-kafka-client-connectivity" tabindex="-1"><a class="header-anchor" href="#verify-kafka-client-connectivity"><span>Verify Kafka Client Connectivity</span></a></h2><p>To verify that we have successfully enabled public internet connectivity to our Kafka cluster from the local development environment, we will use a generic Kafka client to create a topic, publish messages and then subscribe to receive these messages from our Kafka cluster via the public internet.</p><h3 id="install-the-kafka-client" tabindex="-1"><a class="header-anchor" href="#install-the-kafka-client"><span>Install the Kafka Client</span></a></h3><p>First, we must install a Java runtime that can be used by the Kafka client.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">sudo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> yum</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> install</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> java-1.8.0</span></span></code></pre></div><p>Now we are ready to install the Kafka client:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">wget</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> https://archive.apache.org/dist/kafka/2.8.0/kafka_2.13-2.8.0.tgz</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">tar</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -xzf</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> kafka_2.13-2.8.0.tgz</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">cd</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> kafka_2.13-2.8.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11)),i("div",E,[e[114]||(e[114]=i("p",{class:"hint-container-title"},"Tips",-1)),i("p",null,[e[106]||(e[106]=t("We use a generic Kafka client here, however the setup for any Kafka client, including ")),e[107]||(e[107]=i("a",{href:"https://www.xeotek.com/apache-kafka-monitoring-management/",target:"_blank",rel:"noopener noreferrer"},"KaDeck",-1)),e[108]||(e[108]=t(", ")),e[109]||(e[109]=i("a",{href:"https://www.conduktor.io/download/",target:"_blank",rel:"noopener noreferrer"},"Conduktor",-1)),e[110]||(e[110]=t(", and ")),e[111]||(e[111]=i("a",{href:"https://akhq.io/",target:"_blank",rel:"noopener noreferrer"},"akhq.io",-1)),e[112]||(e[112]=t(" will be largely similar. With the ")),s(a),e[113]||(e[113]=t(" proxy you can use these GUI Kafka clients to configure and monitor your Kafka applications, clusters and streams."))])]),e[176]||(e[176]=i("h3",{id:"configure-the-kafka-client",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#configure-the-kafka-client"},[i("span",null,"Configure the Kafka Client")])],-1)),i("p",null,[e[115]||(e[115]=t("With the Kaka client now installed we are ready to configure it and point it at the ")),s(a),e[116]||(e[116]=t(" proxy."))]),i("p",null,[e[117]||(e[117]=t("We need to import the trusted client certificate and corresponding private key into the local key store used by the Kafka client when connecting to the ")),s(a),e[118]||(e[118]=t(" proxy."))]),e[177]||(e[177]=o(`<div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">openssl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> pkcs12</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -export</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -in</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1.cert</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -inkey</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1.pkcs8.key.pem</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -out</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1.p12</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">keytool</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -importkeystore</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -destkeystore</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> /tmp/kafka.client.keystore.jks</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -deststorepass</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> generated</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -srckeystore</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1.p12</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -srcstoretype</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> PKCS12</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -srcstorepass</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> generated</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -alias</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1</span></span></code></pre></div><p>In this example, we are importing a private key and certificate with <code>Common Name</code> <code>client-1</code> signed by a private certificate authority. First the private key and signed certificate are converted into a <code>p12</code> formatted key store.</p><p>Then the key store is converted to <code>/tmp/kafka.client.keystore.jks</code> in <code>JKS</code> format. When prompted, use a consistent password for each command. We use the password <code>generated</code> to illustrate these steps.</p>`,3)),i("p",null,[e[119]||(e[119]=t("The ")),s(a),e[120]||(e[120]=t(" proxy relies on TLS so we need to create a file called ")),e[121]||(e[121]=i("code",null,"client.properties",-1)),e[122]||(e[122]=t(" that tells the Kafka client to use SSL as the security protocol and to specify the key store containing authorized client certificates."))]),s(h,{id:"816",data:[{id:"client.properties"}]},{title0:l(({value:n,isActive:r})=>e[123]||(e[123]=[t("client.properties")])),tab0:l(({value:n,isActive:r})=>e[124]||(e[124]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"security.protocol=SSL")]),t(`
`),i("span",{class:"line"},[i("span",null,"ssl.keystore.location=/tmp/kafka.client.keystore.jks")]),t(`
`),i("span",{class:"line"},[i("span",null,"ssl.keystore.password=generated")])])])],-1)])),_:1}),e[178]||(e[178]=o('<p>The password configured in <code>client.properties</code> should match the password used in the commands above used to create the key store.</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>As the TLS certificate is signed by a globally trusted certificate authority, there is no need to configure your Kafka client to override the trusted certificate authorities.</p></div><h3 id="test-the-kafka-client" tabindex="-1"><a class="header-anchor" href="#test-the-kafka-client"><span>Test the Kafka Client</span></a></h3><blockquote><p>This verifies internet connectivity to your MSK cluster via Zilla Plus for Amazon MSK.</p></blockquote><p>We can now verify that the Kafka client can successfully communicate with your MSK cluster via the internet from your local development environment to create a topic, then publish and subscribe to the same topic.</p><p>If using the wildcard DNS pattern <code>*.example.aklivity.io</code>, then we use the following as TLS bootstrap server names for the Kafka client:</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>b-1.example.aklivity.io:9094,b-2.example.aklivity.io:9094,b-3.example.aklivity.io:9094</span></span></code></pre></div><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Replace these TLS bootstrap server names accordingly for your own custom wildcard DNS pattern.</p></div><h4 id="create-a-topic" tabindex="-1"><a class="header-anchor" href="#create-a-topic"><span>Create a Topic</span></a></h4>',9)),i("p",null,[e[125]||(e[125]=t("Use the Kafka client to create a topic called ")),e[126]||(e[126]=i("code",null,"zilla-proxy-test",-1)),e[127]||(e[127]=t(", replacing ")),e[128]||(e[128]=i("code",null,"<tls-bootstrap-server-names>",-1)),e[129]||(e[129]=t(" in the command below with the TLS proxy names of your ")),s(a),e[130]||(e[130]=t(" proxy:"))]),e[179]||(e[179]=o('<div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">bin/kafka-topics.sh</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --create</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --topic</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla-proxy-test</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --partitions</span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --replication-factor</span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --command-config</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client.properties</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --bootstrap-server</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">tls-bootstrap-server-name</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">s&gt;</span></span></code></pre></div>',1)),i("div",x,[e[143]||(e[143]=i("p",{class:"hint-container-title"},"A quick summary of what just happened",-1)),i("ol",null,[e[139]||(e[139]=i("li",null,"The Kafka client with access to the public internet issued a request to create a new topic",-1)),e[140]||(e[140]=i("li",null,"This request was directed to the internet-facing Network Load Balancer",-1)),i("li",null,[e[131]||(e[131]=t("The Network Load Balancer forwarded the request to the ")),s(a),e[132]||(e[132]=t(" proxy"))]),i("li",null,[e[133]||(e[133]=t("The ")),s(a),e[134]||(e[134]=t(" proxy verified the client identity of the Kafka client"))]),i("li",null,[e[135]||(e[135]=t("The ")),s(a),e[136]||(e[136]=t(" proxy selected a matching client certificate to propagate client identity"))]),i("li",null,[e[137]||(e[137]=t("The ")),s(a),e[138]||(e[138]=t(" proxy routed the request to the appropriate MSK broker"))]),e[141]||(e[141]=i("li",null,"The topic was created in the MSK broker",-1)),e[142]||(e[142]=i("li",null,"Public access was verified, authorized by trusted client certificate",-1))])]),e[180]||(e[180]=o(`<h4 id="publish-messages" tabindex="-1"><a class="header-anchor" href="#publish-messages"><span>Publish messages</span></a></h4><p>Publish two messages to the newly created topic via the following producer command:</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">bin/kafka-console-producer.sh</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --topic</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla-proxy-test</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --producer.config</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client.properties</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --broker-list</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">tls-bootstrap-server-name</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">s&gt;</span></span></code></pre></div><p>A prompt will appear for you to type in the messages:</p><div class="language-output" data-highlighter="shiki" data-ext="output" data-title="output" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>&gt;This is my first event</span></span>
<span class="line"><span>&gt;This is my second event</span></span></code></pre></div><h4 id="receive-messages" tabindex="-1"><a class="header-anchor" href="#receive-messages"><span>Receive messages</span></a></h4><p>Read these messages back via the following consumer command:</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">bin/kafka-console-consumer.sh</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --topic</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla-proxy-test</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --from-beginning</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --consumer.config</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client.properties</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --bootstrap-server</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">tls-bootstrap-server-name</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">s&gt;</span></span></code></pre></div><p>You should see the <code>This is my first event</code> and <code>This is my second event</code> messages.</p><div class="language-output" data-highlighter="shiki" data-ext="output" data-title="output" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>This is my first event</span></span>
<span class="line"><span>This is my second event</span></span></code></pre></div><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2>`,11)),i("p",null,[e[145]||(e[145]=t("You have successfully deployed the ")),e[146]||(e[146]=i("a",{href:"https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44",target:"_blank",rel:"noopener noreferrer"},"Zilla Plus for Amazon MSK",-1)),e[147]||(e[147]=t(" Secure Public Access. Instructions on how to Monitor and Upgrade your ")),s(a),e[148]||(e[148]=t(" proxy can be found in the ")),s(d,{to:"/solutions/how-tos/aws-services/manage-cloudformation-stack.html"},{default:l(()=>e[144]||(e[144]=[t("managing a cloudformation stack")])),_:1}),e[149]||(e[149]=t(" section."))])])}const K=k(y,[["render",z],["__file","production-mutual-tls.html.vue"]]),N=JSON.parse('{"path":"/solutions/how-tos/amazon-msk/secure-public-access/production-mutual-tls.html","title":"Amazon MSK Mutual TLS authentication","lang":"en-US","frontmatter":{"icon":"aky-zilla-plus","description":"Setup mutual authentication to your mTLS Amazon MSK cluster from anywhere on the internet.","gitInclude":["../../../_partials/secure-public-access/configure-global-dns.md","../../../_partials/secure-public-access/verify-kafka-connect.md","../../../_partials/secure-public-access/create-topic.md","../../../_partials/secure-public-access/send-message.md"],"head":[["meta",{"property":"og:url","content":"https://docs.aklivity.io/zilla-docs/next/solutions/how-tos/amazon-msk/secure-public-access/production-mutual-tls.html"}],["meta",{"property":"og:site_name","content":"Documentation"}],["meta",{"property":"og:title","content":"Amazon MSK Mutual TLS authentication"}],["meta",{"property":"og:description","content":"Setup mutual authentication to your mTLS Amazon MSK cluster from anywhere on the internet."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Amazon MSK Mutual TLS authentication\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Overview","slug":"overview","link":"#overview","children":[{"level":3,"title":"AWS services used","slug":"aws-services-used","link":"#aws-services-used","children":[]}]},{"level":2,"title":"Prerequisites","slug":"prerequisites","link":"#prerequisites","children":[{"level":3,"title":"Create Certificate Authority for mTLS","slug":"create-certificate-authority-for-mtls","link":"#create-certificate-authority-for-mtls","children":[]},{"level":3,"title":"Create the MSK Cluster","slug":"create-the-msk-cluster","link":"#create-the-msk-cluster","children":[{"level":4,"title":"Create Client Certificate for mTLS","slug":"create-client-certificate-for-mtls","link":"#create-client-certificate-for-mtls","children":[]}]},{"level":3,"title":"Create the  proxy security group","slug":"create-the-proxy-security-group","link":"#create-the-proxy-security-group","children":[]},{"level":3,"title":"Update the default security group rules","slug":"update-the-default-security-group-rules","link":"#update-the-default-security-group-rules","children":[{"level":4,"title":"Add a Custom TCP Rule","slug":"add-a-custom-tcp-rule","link":"#add-a-custom-tcp-rule","children":[]}]},{"level":3,"title":"Create the  proxy IAM security role","slug":"create-the-proxy-iam-security-role","link":"#create-the-proxy-iam-security-role","children":[{"level":4,"title":"IAM role Inline Policies","slug":"iam-role-inline-policies","link":"#iam-role-inline-policies","children":[]}]}]},{"level":2,"title":"Subscribe via AWS Marketplace","slug":"subscribe-via-aws-marketplace","link":"#subscribe-via-aws-marketplace","children":[]},{"level":2,"title":"Create the Public TLS Server Certificate","slug":"create-the-public-tls-server-certificate","link":"#create-the-public-tls-server-certificate","children":[]},{"level":2,"title":"Deploy the Zilla Plus Secure Public Access Proxy","slug":"deploy-the-zilla-plus-secure-public-access-proxy","link":"#deploy-the-zilla-plus-secure-public-access-proxy","children":[{"level":3,"title":"Step 1. Create Stack","slug":"step-1-create-stack","link":"#step-1-create-stack","children":[]},{"level":3,"title":"Step 2. Specify stack details","slug":"step-2-specify-stack-details","link":"#step-2-specify-stack-details","children":[]},{"level":3,"title":"Step 3. Configure stack options: (use defaults)","slug":"step-3-configure-stack-options-use-defaults","link":"#step-3-configure-stack-options-use-defaults","children":[]},{"level":3,"title":"Step 4. Review","slug":"step-4-review","link":"#step-4-review","children":[]}]},{"level":2,"title":"Verify  proxy Service","slug":"verify-proxy-service","link":"#verify-proxy-service","children":[{"level":3,"title":"Configure Global DNS","slug":"configure-global-dns","link":"#configure-global-dns","children":[]}]},{"level":2,"title":"Verify Kafka Client Connectivity","slug":"verify-kafka-client-connectivity","link":"#verify-kafka-client-connectivity","children":[{"level":3,"title":"Install the Kafka Client","slug":"install-the-kafka-client","link":"#install-the-kafka-client","children":[]},{"level":3,"title":"Configure the Kafka Client","slug":"configure-the-kafka-client","link":"#configure-the-kafka-client","children":[]},{"level":3,"title":"Test the Kafka Client","slug":"test-the-kafka-client","link":"#test-the-kafka-client","children":[{"level":4,"title":"Create a Topic","slug":"create-a-topic","link":"#create-a-topic","children":[]},{"level":4,"title":"Publish messages","slug":"publish-messages","link":"#publish-messages","children":[]},{"level":4,"title":"Receive messages","slug":"receive-messages","link":"#receive-messages","children":[]}]}]},{"level":2,"title":"Conclusion","slug":"conclusion","link":"#conclusion","children":[]}],"readingTime":{"minutes":8.11,"words":2434},"filePathRelative":"solutions/how-tos/amazon-msk/secure-public-access/production-mutual-tls.md"}');export{K as comp,N as data};
