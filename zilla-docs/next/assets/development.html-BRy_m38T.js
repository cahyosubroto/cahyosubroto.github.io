import{_ as k}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c,a as i,b as s,d as t,f as o,e as a,r as h,o as g}from"./app-DQ2AyMtK.js";const y={},m={class:"zilla-plus-badge hint-container info"},v={href:"https://www.aklivity.io/products/zilla-plus",target:"_blank",rel:"noopener noreferrer"},f={class:"hint-container tip"},b={id:"create-the-proxy-security-group",tabindex:"-1"},F={class:"header-anchor",href:"#create-the-proxy-security-group"},D={id:"create-the-proxy-iam-security-role",tabindex:"-1"},C={class:"header-anchor",href:"#create-the-proxy-iam-security-role"},x={class:"hint-container info"},w={id:"verify-proxy-service",tabindex:"-1"},A={class:"header-anchor",href:"#verify-proxy-service"},S={class:"hint-container tip"},E={class:"hint-container info"},z={class:"hint-container warning"},M={class:"hint-container tip"};function P(K,e){const r=h("ZillaPlus"),p=h("RouteLink"),d=h("CodeTabs"),u=h("Tabs");return g(),c("div",null,[e[150]||(e[150]=i("h1",{id:"amazon-msk-unauthorized-access",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#amazon-msk-unauthorized-access"},[i("span",null,"Amazon MSK Unauthorized access")])],-1)),i("p",m,[i("a",v,[e[0]||(e[0]=s("Available in ")),t(r)])]),e[151]||(e[151]=o('<div class="hint-container info"><p class="hint-container-title">Estimated time to complete 20-30 minutes.</p></div><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h2><p>The <a href="https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44" target="_blank" rel="noopener noreferrer">Zilla Plus for Amazon MSK</a> Secure Public Access proxy lets authorized Kafka clients connect, publish messages and subscribe to topics in your Amazon MSK cluster via the internet.</p><p>In this guide we will deploy the Zilla Plus for Amazon MSK Secure Public Access proxy and verify locally trusted public internet connectivity to your MSK cluster from a Kafka client, using the wildcard domain <code>*.aklivity.example.com</code>.</p><h3 id="aws-services-used" tabindex="-1"><a class="header-anchor" href="#aws-services-used"><span>AWS services used</span></a></h3><table><thead><tr><th>Service</th><th>Required</th><th>Usage</th><th>Quota</th></tr></thead><tbody><tr><td>Resource Groups and Tagging</td><td>Yes</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/arg.html#arg-quotas" target="_blank" rel="noopener noreferrer">None</a></td></tr><tr><td>Secrets Manager</td><td>Yes</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/asm.html#limits_secrets-manager" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr><tr><td>Certificate Manager</td><td>No<br><br>Private key and certificate can be inline in Secrets Manager instead</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/acm.html#limits_acm" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr><tr><td>Private Certificate Manager</td><td>No<br><br>Private key and certificate can be inline in Secrets Manager instead</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/acm-pca.html#limits_acm-pca" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr></tbody></table><p>Default <a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html" target="_blank" rel="noopener noreferrer">AWS Service Quotas</a> are recommended.</p><h2 id="prerequisites" tabindex="-1"><a class="header-anchor" href="#prerequisites"><span>Prerequisites</span></a></h2><p>Before setting up internet access to your MSK Cluster, you will need the following:</p>',9)),i("ul",null,[e[5]||(e[5]=i("li",null,"an MSK Cluster configured for TLS encrypted client access",-1)),e[6]||(e[6]=i("li",null,"subscription to Zilla Plus for Amazon MSK via AWS Marketplace",-1)),i("li",null,[e[1]||(e[1]=s("an VPC security group for the ")),t(r),e[2]||(e[2]=s(" proxies"))]),i("li",null,[e[3]||(e[3]=s("an IAM security role for the ")),t(r),e[4]||(e[4]=s(" proxies"))]),e[7]||(e[7]=i("li",null,[s("permission to modify local DNS resolution files, such as "),i("code",null,"/etc/hosts"),s(" on MacOS")],-1))]),i("div",f,[e[11]||(e[11]=i("p",{class:"hint-container-title"},"Tips",-1)),i("p",null,[e[9]||(e[9]=s("Check out the ")),t(p,{to:"/solutions/how-tos/aws-services/troubleshooting.html"},{default:a(()=>e[8]||(e[8]=[s("Troubleshooting")])),_:1}),e[10]||(e[10]=s(" guide if you run into any issues."))])]),e[152]||(e[152]=i("h3",{id:"create-the-msk-cluster",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#create-the-msk-cluster"},[i("span",null,"Create the MSK Cluster")])],-1)),e[153]||(e[153]=i("blockquote",null,[i("p",null,"This creates your MSK cluster in preparation for secure access via the internet.")],-1)),e[154]||(e[154]=i("p",null,"An MSK cluster is needed for secure remote access via the internet. You can skip this step if you have already created an MSK cluster with equivalent configuration.",-1)),i("p",null,[e[13]||(e[13]=s("Follow the ")),t(p,{to:"/solutions/how-tos/aws-services/create-msk-cluster.html"},{default:a(()=>e[12]||(e[12]=[s("Create MSK Cluster")])),_:1}),e[14]||(e[14]=s(" guide to setup the a new MSK cluster. We will use the below resource names to reference the AWS resources needed in this guide."))]),e[155]||(e[155]=o("<ul><li>Cluster Name: <code>my-msk-cluster</code></li><li>Access control methods: <code>Unauthenticated access</code></li><li>VPC: <code>my-msk-cluster-vpc</code></li><li>Subnet: <code>my-msk-cluster-subnet-*</code></li><li>Route tables: <code>my-msk-cluster-rtb-*</code></li><li>Internet gateway: <code>my-msk-cluster-igw</code></li></ul>",1)),i("h3",b,[i("a",F,[i("span",null,[e[15]||(e[15]=s("Create the ")),t(r),e[16]||(e[16]=s(" proxy security group"))])])]),i("blockquote",null,[i("p",null,[e[17]||(e[17]=s("This creates your ")),t(r),e[18]||(e[18]=s(" proxy security group to allow Kafka clients and SSH access."))])]),i("p",null,[e[19]||(e[19]=s("A VPC security group is needed for the ")),t(r),e[20]||(e[20]=s(" proxies when they are launched."))]),i("p",null,[e[21]||(e[21]=s("Follow the ")),e[22]||(e[22]=i("a",{href:"https://console.aws.amazon.com/vpcconsole/home#CreateSecurityGroup:",target:"_blank",rel:"noopener noreferrer"},"Create Security Group",-1)),e[23]||(e[23]=s(" wizard with the following parameters and defaults. This creates your ")),t(r),e[24]||(e[24]=s(" proxy security group to allow Kafka clients and SSH access."))]),e[156]||(e[156]=o('<ul><li>VPC: <code>my-msk-cluster-vpc</code></li><li>Name: <code>my-zilla-proxy-sg</code></li><li>Description: <code>Kafka clients and SSH access</code></li><li>Add Inbound Rule <ul><li>Type: <code>CUSTOM TCP</code></li><li>Port Range: <code>9094</code></li><li>Source type: <code>Anywhere-IPv4</code></li></ul></li><li>Add Inbound Rule <ul><li>Type: <code>SSH</code></li><li>Source type: <code>My IP</code></li></ul></li><li>Add Outbound Rule (if not exists) <ul><li>Type: <code>All traffic</code></li><li>Destination: <code>Anywhere-IPv4</code></li></ul></li><li>Create the Security Group</li></ul><div class="hint-container warning"><p class="hint-container-title">Check your network settings</p><p>Your IP may be different when you SSH into the EC2 instance. VPNs and other networking infrastructure may cause the <code>My IP</code> inbound rule to fail. Instead, you can use one of the other ways AWS provides to execute commands in an EC2 instance.</p></div><h3 id="update-the-default-security-group-rules" tabindex="-1"><a class="header-anchor" href="#update-the-default-security-group-rules"><span>Update the default security group rules</span></a></h3>',3)),i("blockquote",null,[i("p",null,[e[25]||(e[25]=s("This allows the ")),t(r),e[26]||(e[26]=s(" proxies to communicate with your MSK cluster."))])]),e[157]||(e[157]=o('<p>Navigate to the VPC Management Console <a href="https://console.aws.amazon.com/vpc/home#securityGroups:" target="_blank" rel="noopener noreferrer">Security Groups</a> table.</p><div class="hint-container note"><p class="hint-container-title">Check your selected region</p><p>Make sure you have selected the desired region, ex: <code>US East (N. Virginia) us-east-1</code>.</p></div><p>Filter the security groups by selecting a <code>VPC</code> and select the <code>default</code> security group.</p><ul><li>VPC: <code>my-msk-cluster-vpc</code></li><li>Security Group: <code>default</code></li></ul><h4 id="add-a-custom-tcp-rule" tabindex="-1"><a class="header-anchor" href="#add-a-custom-tcp-rule"><span>Add a Custom TCP Rule</span></a></h4>',5)),i("p",null,[e[27]||(e[27]=s("Add this Inbound Rule to allow the ")),t(r),e[28]||(e[28]=s(" proxies to communicate with the MSK cluster."))]),e[158]||(e[158]=i("ul",null,[i("li",null,[s("Type: "),i("code",null,"Custom TCP")]),i("li",null,[s("Port Range: "),i("code",null,"9094")]),i("li",null,[s("Source type: "),i("code",null,"Custom")]),i("li",null,[s("Source: "),i("code",null,"my-zilla-proxy-sg")])],-1)),i("h3",D,[i("a",C,[i("span",null,[e[29]||(e[29]=s("Create the ")),t(r),e[30]||(e[30]=s(" proxy IAM security role"))])])]),i("blockquote",null,[i("p",null,[e[31]||(e[31]=s("This creates an IAM security role to enable the required AWS services for the ")),t(r),e[32]||(e[32]=s(" proxies."))])]),i("p",null,[e[34]||(e[34]=s("Follow the ")),t(p,{to:"/solutions/how-tos/aws-services/create-iam-role.html"},{default:a(()=>e[33]||(e[33]=[s("Create IAM Role")])),_:1}),e[35]||(e[35]=s(" guide to create an IAM security role with the following parameters:"))]),t(d,{id:"350",data:[{id:"Name"},{id:"Policies"}]},{title0:a(({value:l,isActive:n})=>e[36]||(e[36]=[s("Name")])),title1:a(({value:l,isActive:n})=>e[37]||(e[37]=[s("Policies")])),tab0:a(({value:l,isActive:n})=>e[38]||(e[38]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"aklivity-zilla-proxy")])])])],-1)])),tab1:a(({value:l,isActive:n})=>e[39]||(e[39]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"AWSCertificateManagerReadOnly")]),s(`
`),i("span",{class:"line"},[i("span",null,"AWSCertificateManagerPrivateCAReadOnly")]),s(`
`),i("span",{class:"line"},[i("span",null,"ResourceGroupsandTagEditorReadOnlyAccess")]),s(`
`),i("span",{class:"line"},[i("span",null,"AmazonSSMManagedInstanceCore")])])])],-1)])),_:1}),e[159]||(e[159]=i("h4",{id:"iam-role-inline-policies",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#iam-role-inline-policies"},[i("span",null,"IAM role Inline Policies")])],-1)),i("p",null,[e[40]||(e[40]=s("This creates an IAM security role to enable the required AWS services for the ")),t(r),e[41]||(e[41]=s(" proxies."))]),t(d,{id:"364",data:[{id:"Name"},{id:"JSON Summary"}]},{title0:a(({value:l,isActive:n})=>e[42]||(e[42]=[s("Name")])),title1:a(({value:l,isActive:n})=>e[43]||(e[43]=[s("JSON Summary")])),tab0:a(({value:l,isActive:n})=>e[44]||(e[44]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"MSKProxySecretsManagerRead")])])])],-1)])),tab1:a(({value:l,isActive:n})=>e[45]||(e[45]=[i("div",{class:"language-json","data-highlighter":"shiki","data-ext":"json","data-title":"json",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"{")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'  "Version"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'"2012-10-17"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'  "Statement"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": [")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"    {")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'      "Sid"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'"VisualEditor0"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'      "Effect"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'"Allow"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'      "Action"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": [")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "secretsmanager:GetSecretValue"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "secretsmanager:DescribeSecret"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"      ],")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#0451A5","--shiki-dark":"#9CDCFE"}},'      "Resource"'),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": [")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},'        "arn:aws:secretsmanager:*:*:secret:wildcard.aklivity.example.com-*"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"      ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"    }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"  ]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"}")])])])],-1)])),_:1}),e[160]||(e[160]=o('<div class="hint-container info"><p class="hint-container-title">If you used a different secret name for your certificate key.</p><p>Replace <code>wildcard.example.aklivity.io</code> in the resource regular expression for:</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>MSKProxySecretsManagerRead</span></span></code></pre></div></div><h2 id="subscribe-via-aws-marketplace" tabindex="-1"><a class="header-anchor" href="#subscribe-via-aws-marketplace"><span>Subscribe via AWS Marketplace</span></a></h2><p>The <a href="https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44" target="_blank" rel="noopener noreferrer">Zilla Plus for Amazon MSK</a> is available through the AWS Marketplace. You can skip this step if you have already subscribed to Zilla Plus for Amazon MSK via AWS Marketplace.</p><p>To get started, visit the Proxy&#39;s Marketplace <a href="https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44" target="_blank" rel="noopener noreferrer">Product Page</a> and <code>Subscribe</code> to the offering. You should now see <code>Zilla Plus for Amazon MSK</code> listed in your <a href="https://console.aws.amazon.com/marketplace" target="_blank" rel="noopener noreferrer">AWS Marketplace</a> subscriptions.</p><h2 id="create-the-server-certificate" tabindex="-1"><a class="header-anchor" href="#create-the-server-certificate"><span>Create the Server Certificate</span></a></h2><p>We need a TLS Server Certificate for the wildcard domain <code>*.aklivity.example.com</code> that can be trusted by a Kafka Client.</p>',6)),i("p",null,[e[47]||(e[47]=s("Follow the ")),t(p,{to:"/solutions/how-tos/aws-services/create-server-certificate-acm.html"},{default:a(()=>e[46]||(e[46]=[s("Create Server Certificate")])),_:1}),e[48]||(e[48]=s(" guide to create a new TLS Server Certificate for the example wildcard domain ")),e[49]||(e[49]=i("code",null,"*.aklivity.example.com",-1)),e[50]||(e[50]=s("."))]),e[161]||(e[161]=o('<div class="hint-container info"><p class="hint-container-title">Info</p><p>Note the server certificate secret ARN as we will need to reference it from the Secure Public Access CloudFormation template.</p></div><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Store the private CA certificate in a file called <code>pca.pem</code> as we will need it to configure trust when testing the Kafka client.</p></div><h2 id="deploy-the-zilla-plus-secure-public-access-proxy" tabindex="-1"><a class="header-anchor" href="#deploy-the-zilla-plus-secure-public-access-proxy"><span>Deploy the Zilla Plus Secure Public Access Proxy</span></a></h2><blockquote><p>This initiates deployment of the Zilla Plus for Amazon MSK stack via CloudFormation.</p></blockquote><p>Navigate to your <a href="https://console.aws.amazon.com/marketplace" target="_blank" rel="noopener noreferrer">AWS Marketplace</a> subscriptions and select <code>Zilla Plus for Amazon MSK</code> to show the manage subscription page.</p><ul><li>From the <code>Agreement</code> section &gt; <code>Actions</code> menu &gt; select <code>Launch CloudFormation stack</code></li><li>Select the <code>Secure Public Access (Unauthorized/SASL)</code> fulfillment option</li><li>Make sure you have selected the desired region selected, such as <code>us-east-1</code></li><li>Click <code>Continue to Launch</code><ul><li>Choose the action <code>Launch CloudFormation</code></li></ul></li></ul><p>Click <code>Launch</code> to complete the <code>Create stack</code> wizard with the following details:</p><h3 id="step-1-create-stack" tabindex="-1"><a class="header-anchor" href="#step-1-create-stack"><span>Step 1. Create Stack</span></a></h3><ul><li>Prepare template: <code>Template is ready</code></li><li>Specify template: <code>Amazon S3 URL</code><ul><li>Amazon S3 URL: <code>(auto-filled)</code></li></ul></li></ul><h3 id="step-2-specify-stack-details" tabindex="-1"><a class="header-anchor" href="#step-2-specify-stack-details"><span>Step 2. Specify stack details</span></a></h3>',10)),t(d,{id:"474",data:[{id:"Stack name"}]},{title0:a(({value:l,isActive:n})=>e[51]||(e[51]=[s("Stack name")])),tab0:a(({value:l,isActive:n})=>e[52]||(e[52]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"my-zilla-proxy")])])])],-1)])),_:1}),e[162]||(e[162]=i("p",null,"Parameters:",-1)),i("ul",null,[e[64]||(e[64]=o("<li>Network Configuration <ul><li>VPC: <code>my-msk-cluster-vpc</code></li><li>Subnets: <code>my-msk-cluster-1a</code> <code>my-msk-cluster-1b</code> <code>my-msk-cluster-1c</code></li></ul></li><li>MSK Configuration <ul><li>Wildcard DNS pattern: <code>*.aklivity.[...].amazonaws.com</code> *1</li><li>Port number: <code>9094</code></li></ul></li><li>Secure Public Access Configuration <ul><li>Instance count: <code>2</code></li><li>Instance type: <code>t3.small</code> *2</li><li>Role: <code>aklivity-zilla-proxy</code></li><li>Security Groups: <code>my-zilla-proxy</code></li><li>Secrets Manager Secret ARN: <code>&lt;TLS certificate private key secret ARN&gt;</code> *3</li><li>Public Wildcard DNS: <code>*.aklivity.example.com</code></li><li>Public Port: <code>9094</code></li><li>Key pair for SSH access: <code>my-key-pair</code> *4</li></ul></li>",3)),i("li",null,[e[63]||(e[63]=s("*Configuration Reference ")),i("ol",null,[i("li",null,[e[54]||(e[54]=s("Follow the ")),t(p,{to:"/solutions/how-tos/aws-services/lookup-msk-server-names.html"},{default:a(()=>e[53]||(e[53]=[s("Lookup MSK Server Names")])),_:1}),e[55]||(e[55]=s(" guide to discover the wildcard DNS pattern for your MSK cluster."))]),e[62]||(e[62]=i("li",null,"Consider the network throughput characteristics of the AWS instance type as that will impact the upper bound on network performance.",-1)),i("li",null,[e[57]||(e[57]=s("This is the ARN of the created secret for the signed certificate's private key that was returned in the last step of the ")),t(p,{to:"/solutions/how-tos/aws-services/create-server-certificate-acm.html#store-the-encrypted-secret"},{default:a(()=>e[56]||(e[56]=[s("Create Server Certificate")])),_:1}),e[58]||(e[58]=s(" guide."))]),i("li",null,[e[60]||(e[60]=s("Follow the ")),t(p,{to:"/solutions/how-tos/aws-services/create-key-pair.html"},{default:a(()=>e[59]||(e[59]=[s("Create Key Pair")])),_:1}),e[61]||(e[61]=s(" guide to create a new key pair to access EC2 instances via SSH."))])])])]),e[163]||(e[163]=i("h3",{id:"step-3-configure-stack-options-use-defaults",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#step-3-configure-stack-options-use-defaults"},[i("span",null,[s("Step 3. Configure stack options: "),i("code",null,"(use defaults)")])])],-1)),e[164]||(e[164]=i("h3",{id:"step-4-review",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#step-4-review"},[i("span",null,"Step 4. Review")])],-1)),e[165]||(e[165]=i("p",null,[s("Confirm the stack details are correct and "),i("code",null,"Submit"),s(" to start the CloudFormation deploy.")],-1)),i("div",x,[e[71]||(e[71]=i("p",{class:"hint-container-title"},"Info",-1)),i("p",null,[e[65]||(e[65]=s("When your ")),t(r),e[66]||(e[66]=s(" proxy is ready, the ")),e[67]||(e[67]=i("a",{href:"https://console.aws.amazon.com/cloudformation",target:"_blank",rel:"noopener noreferrer"},"CloudFormation console",-1)),e[68]||(e[68]=s(" will show ")),e[69]||(e[69]=i("code",null,"CREATE_COMPLETE",-1)),e[70]||(e[70]=s(" for the newly created stack."))])]),i("h2",w,[i("a",A,[i("span",null,[e[72]||(e[72]=s("Verify ")),t(r),e[73]||(e[73]=s(" proxy Service"))])])]),e[166]||(e[166]=i("blockquote",null,[i("p",null,"This checks that the services and networking were properly configured.")],-1)),e[167]||(e[167]=i("p",null,[s("Navigate to the "),i("a",{href:"https://console.aws.amazon.com/ec2/home#Instances:instanceState=running",target:"_blank",rel:"noopener noreferrer"},"EC2 running instances dashboard.")],-1)),e[168]||(e[168]=i("div",{class:"hint-container note"},[i("p",{class:"hint-container-title"},"Check your selected region"),i("p",null,[s("Make sure you have selected the desired region, ex: "),i("code",null,"US East (N. Virginia) us-east-1"),s(".")])],-1)),i("p",null,[e[74]||(e[74]=s("Select either of the ")),t(r),e[75]||(e[75]=s(" proxies launched by the CloudFormation template to show the details."))]),e[169]||(e[169]=o('<div class="hint-container info"><p class="hint-container-title">Info</p><p>They each have an IAM Role name starting with <code>aklivity-zilla-proxy</code>.</p></div><p>Find the <code>Public IPv4 Address</code> and then SSH into the instance.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">ssh</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -i</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> ~/.ssh/</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">key-pair.ce</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">r&gt; </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">ec2-user@</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">instance-public-ip-addres</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">s&gt;</span></span></code></pre></div><p>After logging in via SSH, check the status of the <code>zilla-plus</code> system service.</p>',4)),t(u,{id:"637",data:[{id:"Service is running"},{id:"Check Ports"},{id:"Check Zilla Logs"},{id:"Check Cloud Init Logs"}]},{title0:a(({value:l,isActive:n})=>e[76]||(e[76]=[s("Service is running")])),title1:a(({value:l,isActive:n})=>e[77]||(e[77]=[s("Check Ports")])),title2:a(({value:l,isActive:n})=>e[78]||(e[78]=[s("Check Zilla Logs")])),title3:a(({value:l,isActive:n})=>e[79]||(e[79]=[s("Check Cloud Init Logs")])),tab0:a(({value:l,isActive:n})=>e[80]||(e[80]=[i("p",null,[s("Verify that the "),i("code",null,"zilla-plus"),s(" service is active and logging output similar to that shown below.")],-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"systemctl"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," status"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," zilla-plus.service")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"zilla-plus.service - Zilla Plus")]),s(`
`),i("span",{class:"line"},[i("span",null,"   Loaded: loaded (/etc/systemd/system/zilla-plus.service; enabled; vendor preset: disabled)")]),s(`
`),i("span",{class:"line"},[i("span",null,"   Active: active (running) since...")])])])],-1)])),tab1:a(({value:l,isActive:n})=>e[81]||(e[81]=[i("p",null,[s("Check for the active ports with "),i("code",null,"netstat"),s(".")],-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"netstat"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -ntlp")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"tcp6    0    0 :::9092    :::*    LISTEN    1726/.zpm/image/bin")])])])],-1)])),tab2:a(({value:l,isActive:n})=>e[82]||(e[82]=[i("p",null,[s("You can get an stdout dump of the "),i("code",null,"zilla-plus.service"),s(" using "),i("code",null,"journalctl"),s(".")],-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"journalctl"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -e"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -u"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," zilla-plus.service"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}}," | "),i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"tee"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -a"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," /tmp/zilla.log")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"systemd[1]: Started zilla-plus.service - Zilla Plus.")]),s(`
`),i("span",{class:"line"},[i("span",null,"...")])])])],-1)])),tab3:a(({value:l,isActive:n})=>e[83]||(e[83]=[i("p",null,[s("All output from cloud-init is captured by default to "),i("code",null,"/var/log/cloud-init-output.log"),s(". There shouldn't be any errors in this log.")],-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"cat"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," /var/log/cloud-init-output.log")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"Cloud-init v. 22.2.2 running 'init'...")])])])],-1)])),_:1}),i("p",null,[e[84]||(e[84]=s("Check the networking of the ")),t(r),e[85]||(e[85]=s(" proxy instances to MSK."))]),t(u,{id:"670",data:[{id:"DNS resolving"},{id:"Check Ports"}]},{title0:a(({value:l,isActive:n})=>e[86]||(e[86]=[s("DNS resolving")])),title1:a(({value:l,isActive:n})=>e[87]||(e[87]=[s("Check Ports")])),tab0:a(({value:l,isActive:n})=>e[88]||(e[88]=[i("p",null,"Verify that the instance can resolve the private Route53 DNS address.",-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"nslookup"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," *"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},".aklivity.[...].amazonaws.com")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"Server:		***")]),s(`
`),i("span",{class:"line"},[i("span",null,"Address:	***")]),s(`
`),i("span",{class:"line"},[i("span")]),s(`
`),i("span",{class:"line"},[i("span",null,"Non-authoritative answer:")]),s(`
`),i("span",{class:"line"},[i("span",null,"Name:	*.aklivity.[...].amazonaws.com")]),s(`
`),i("span",{class:"line"},[i("span",null,"Address: ***")])])])],-1)])),tab1:a(({value:l,isActive:n})=>e[89]||(e[89]=[i("p",null,[s("Check the communication over necessary ports with "),i("code",null,"netcat"),s(".")],-1),i("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"nc"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -vz"),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," *"),i("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}},".aklivity.[...].amazonaws.com"),i("span",{style:{"--shiki-light":"#098658","--shiki-dark":"#B5CEA8"}}," 9096")])])])],-1),i("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"Connection to *.aklivity.[...].amazonaws.com port 9096 [tcp/italk] succeeded!")])])])],-1)])),_:1}),i("p",null,[e[90]||(e[90]=s("Repeat these steps for each of the other ")),t(r),e[91]||(e[91]=s(" proxies launched by the CloudFormation template if necessary."))]),e[170]||(e[170]=o(`<h2 id="verify-kafka-client-connectivity" tabindex="-1"><a class="header-anchor" href="#verify-kafka-client-connectivity"><span>Verify Kafka Client Connectivity</span></a></h2><p>To verify that we have successfully enabled public internet connectivity to our Kafka cluster from the local development environment, we will use a generic Kafka client to create a topic, publish messages and then subscribe to receive these messages from our Kafka cluster via the public internet.</p><h3 id="install-the-kafka-client" tabindex="-1"><a class="header-anchor" href="#install-the-kafka-client"><span>Install the Kafka Client</span></a></h3><p>First, we must install a Java runtime that can be used by the Kafka client.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">sudo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> yum</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> install</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> java-1.8.0</span></span></code></pre></div><p>Now we are ready to install the Kafka client:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">wget</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> https://archive.apache.org/dist/kafka/2.8.0/kafka_2.13-2.8.0.tgz</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">tar</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -xzf</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> kafka_2.13-2.8.0.tgz</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">cd</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> kafka_2.13-2.8.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7)),i("div",S,[e[100]||(e[100]=i("p",{class:"hint-container-title"},"Tips",-1)),i("p",null,[e[92]||(e[92]=s("We use a generic Kafka client here, however the setup for any Kafka client, including ")),e[93]||(e[93]=i("a",{href:"https://www.xeotek.com/apache-kafka-monitoring-management/",target:"_blank",rel:"noopener noreferrer"},"KaDeck",-1)),e[94]||(e[94]=s(", ")),e[95]||(e[95]=i("a",{href:"https://www.conduktor.io/download/",target:"_blank",rel:"noopener noreferrer"},"Conduktor",-1)),e[96]||(e[96]=s(", and ")),e[97]||(e[97]=i("a",{href:"https://akhq.io/",target:"_blank",rel:"noopener noreferrer"},"akhq.io",-1)),e[98]||(e[98]=s(" will be largely similar. With the ")),t(r),e[99]||(e[99]=s(" proxy you can use these GUI Kafka clients to configure and monitor your Kafka applications, clusters and streams."))])]),e[171]||(e[171]=o('<h3 id="trust-the-private-certificate-authority" tabindex="-1"><a class="header-anchor" href="#trust-the-private-certificate-authority"><span>Trust the Private Certificate Authority</span></a></h3><p>Import the private CA certificate into your trust store.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">keytool</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -importcert</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -keystore</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> /tmp/kafka.client.truststore.jks</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -storetype</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> jks</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -storepass</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> generated</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -alias</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> pca</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -file</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> Certificate.pem</span></span></code></pre></div>',3)),i("div",E,[e[106]||(e[106]=i("p",{class:"hint-container-title"},"Info",-1)),i("p",null,[e[102]||(e[102]=s("When you followed the ")),t(p,{to:"/solutions/how-tos/aws-services/create-certificate-authority-acm.html"},{default:a(()=>e[101]||(e[101]=[s("Create Certificate Authority")])),_:1}),e[103]||(e[103]=s(" guide, you exported the private CA certificate to a file called ")),e[104]||(e[104]=i("code",null,"Certificate.pem",-1)),e[105]||(e[105]=s("."))])]),e[172]||(e[172]=i("h3",{id:"configure-the-kafka-client",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#configure-the-kafka-client"},[i("span",null,"Configure the Kafka Client")])],-1)),i("p",null,[e[107]||(e[107]=s("With the Kaka client now installed we are ready to configure it and point it at the ")),t(r),e[108]||(e[108]=s(" proxy."))]),i("p",null,[e[109]||(e[109]=s("The ")),t(r),e[110]||(e[110]=s(" proxy relies on TLS so we need to create a file called ")),e[111]||(e[111]=i("code",null,"client.properties",-1)),e[112]||(e[112]=s(" that tells the Kafka client to use SSL as the security protocol and to trust your private certificate authority as the signer of the ")),e[113]||(e[113]=i("code",null,"*.aklivity.example.com",-1)),e[114]||(e[114]=s(" certificate."))]),t(d,{id:"734",data:[{id:"client.properties"}]},{title0:a(({value:l,isActive:n})=>e[115]||(e[115]=[s("client.properties")])),tab0:a(({value:l,isActive:n})=>e[116]||(e[116]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"security.protocol=SSL")]),s(`
`),i("span",{class:"line"},[i("span",null,"ssl.truststore.location=/tmp/kafka.client.truststore.jks")])])])],-1)])),_:1}),e[173]||(e[173]=o(`<h3 id="configure-local-dns" tabindex="-1"><a class="header-anchor" href="#configure-local-dns"><span>Configure Local DNS</span></a></h3><p>When using an example wildcard DNS such as <code>*.aklivity.example.com</code> then the DNS entries are setup locally.</p><p>Navigate to the <a href="https://console.aws.amazon.com/cloudformation" target="_blank" rel="noopener noreferrer">CloudFormation console.</a> Then select the <code>my-zilla-proxy</code> stack to show the details.</p><div class="hint-container note"><p class="hint-container-title">Check your selected region</p><p>Make sure you have selected the desired region, ex: <code>US East (N. Virginia) us-east-1</code>.</p></div><p>In the stack <code>Outputs</code> tab, find the public DNS name of the <code>NetworkLoadBalancer</code>, and lookup the public IP addresses, as shown in the following example.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">nslookup</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> my-pu-Netwo-xxxxxxxxxxxx-yyyyyyyyyyyyyyyy.elb.us-east-1.amazonaws.com</span></span></code></pre></div><div class="language-output" data-highlighter="shiki" data-ext="output" data-title="output" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>Server:  10.5.1.21</span></span>
<span class="line"><span>Address: 10.5.1.21#53</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Non-authoritative answer:</span></span>
<span class="line"><span>Name: my-pu-Netwo-xxxxxxxxxxxx-yyyyyyyyyyyyyyyy.elb.us-east-1.amazonaws.com</span></span>
<span class="line"><span>Address: 107.21.117.233</span></span>
<span class="line"><span>Name: my-pu-Netwo-xxxxxxxxxxxx-yyyyyyyyyyyyyyyy.elb.us-east-1.amazonaws.com</span></span>
<span class="line"><span>Address: 54.235.158.55</span></span>
<span class="line"><span>Name: my-pu-Netwo-xxxxxxxxxxxx-yyyyyyyyyyyyyyyy.elb.us-east-1.amazonaws.com</span></span>
<span class="line"><span>Address: 3.226.64.246</span></span></code></pre></div><p>Then add local DNS entries for the bootstrap proxy names needed by the Kafka client to <code>/etc/hosts</code>.</p>`,8)),t(d,{id:"761",data:[{id:"/etc/hosts"}]},{title0:a(({value:l,isActive:n})=>e[117]||(e[117]=[s("/etc/hosts")])),tab0:a(({value:l,isActive:n})=>e[118]||(e[118]=[i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"107.21.117.233  b-1.aklivity.example.com b-2.aklivity.example.com b-3.aklivity.example.com")]),s(`
`),i("span",{class:"line"},[i("span",null,"54.235.158.55   b-1.aklivity.example.com b-2.aklivity.example.com b-3.aklivity.example.com")]),s(`
`),i("span",{class:"line"},[i("span",null,"3.226.64.246    b-1.aklivity.example.com b-2.aklivity.example.com b-3.aklivity.example.com")])])])],-1)])),_:1}),e[174]||(e[174]=i("p",null,"This allows Kafka clients to use the following TLS bootstrap proxy names for privately signed TLS wildcard certificate:",-1)),e[175]||(e[175]=i("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",null,"b-1.aklivity.example.com:9094,b-2.aklivity.example.com:9094,b-3.aklivity.example.com:9094")])])])],-1)),e[176]||(e[176]=i("p",null,"You can use these bootstrap server names when connecting to your MSK cluster.",-1)),i("div",z,[e[128]||(e[128]=i("p",{class:"hint-container-title"},"Warning",-1)),i("p",null,[e[122]||(e[122]=s("If you add another broker to your MSK cluster, then you will need to add another local DNS entry, such as ")),e[123]||(e[123]=i("code",null,"b-4.aklivity.example.com",-1)),e[124]||(e[124]=s(". This is required only for ")),t(p,{to:"/solutions/how-tos/amazon-msk/secure-public-access/development.html"},{default:a(()=>e[119]||(e[119]=[s("MSK Unauthorized access")])),_:1}),e[125]||(e[125]=s(" deployments, not ")),t(p,{to:"/solutions/how-tos/amazon-msk/secure-public-access/production.html"},{default:a(()=>e[120]||(e[120]=[s("MSK SASL/SCRAM authentication")])),_:1}),e[126]||(e[126]=s(" or ")),t(p,{to:"/solutions/how-tos/amazon-msk/secure-public-access/production-mutual-tls.html"},{default:a(()=>e[121]||(e[121]=[s("MSK mTLS authentication")])),_:1}),e[127]||(e[127]=s("deployments."))])]),e[177]||(e[177]=o('<h3 id="test-the-kafka-client" tabindex="-1"><a class="header-anchor" href="#test-the-kafka-client"><span>Test the Kafka Client</span></a></h3><blockquote><p>This verifies internet connectivity to your MSK cluster via Zilla Plus for Amazon MSK.</p></blockquote><p>We can now verify that the Kafka client can successfully communicate with your MSK cluster via the internet to create a topic, then publish and subscribe to the same topic.</p><p>Use the following as TLS bootstrap server names for the Kafka client:</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>b-1.aklivity.example.com:9094,b-2.aklivity.example.com:9094,b-3.aklivity.example.com:9094</span></span></code></pre></div><h4 id="create-a-topic" tabindex="-1"><a class="header-anchor" href="#create-a-topic"><span>Create a Topic</span></a></h4>',6)),i("p",null,[e[129]||(e[129]=s("Use the Kafka client to create a topic called ")),e[130]||(e[130]=i("code",null,"zilla-proxy-test",-1)),e[131]||(e[131]=s(", replacing ")),e[132]||(e[132]=i("code",null,"<tls-bootstrap-server-names>",-1)),e[133]||(e[133]=s(" in the command below with the TLS proxy names of your ")),t(r),e[134]||(e[134]=s(" proxy:"))]),e[178]||(e[178]=o('<div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">bin/kafka-topics.sh</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --create</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --topic</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla-proxy-test</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --partitions</span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --replication-factor</span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;"> 3</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --command-config</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client.properties</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --bootstrap-server</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">tls-bootstrap-server-name</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">s&gt;</span></span></code></pre></div>',1)),i("div",M,[e[143]||(e[143]=i("p",{class:"hint-container-title"},"A quick summary of what just happened",-1)),i("ol",null,[e[139]||(e[139]=i("li",null,"The Kafka client with access to the public internet issued a request to create a new topic",-1)),e[140]||(e[140]=i("li",null,"This request was directed to the internet-facing Network Load Balancer",-1)),i("li",null,[e[135]||(e[135]=s("The Network Load Balancer forwarded the request to the ")),t(r),e[136]||(e[136]=s(" proxy"))]),i("li",null,[e[137]||(e[137]=s("The ")),t(r),e[138]||(e[138]=s(" proxy routed the request to the appropriate MSK broker"))]),e[141]||(e[141]=i("li",null,"The topic was created in the MSK broker",-1)),e[142]||(e[142]=i("li",null,"Public access was verified",-1))])]),e[179]||(e[179]=o(`<h4 id="publish-messages" tabindex="-1"><a class="header-anchor" href="#publish-messages"><span>Publish messages</span></a></h4><p>Publish two messages to the newly created topic via the following producer command:</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">bin/kafka-console-producer.sh</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --topic</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla-proxy-test</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --producer.config</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client.properties</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --broker-list</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">tls-bootstrap-server-name</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">s&gt;</span></span></code></pre></div><p>A prompt will appear for you to type in the messages:</p><div class="language-output" data-highlighter="shiki" data-ext="output" data-title="output" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>&gt;This is my first event</span></span>
<span class="line"><span>&gt;This is my second event</span></span></code></pre></div><h4 id="receive-messages" tabindex="-1"><a class="header-anchor" href="#receive-messages"><span>Receive messages</span></a></h4><p>Read these messages back via the following consumer command:</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">bin/kafka-console-consumer.sh</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --topic</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla-proxy-test</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --from-beginning</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --consumer.config</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client.properties</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --bootstrap-server</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">tls-bootstrap-server-name</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">s&gt;</span></span></code></pre></div><p>You should see the <code>This is my first event</code> and <code>This is my second event</code> messages.</p><div class="language-output" data-highlighter="shiki" data-ext="output" data-title="output" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>This is my first event</span></span>
<span class="line"><span>This is my second event</span></span></code></pre></div><h2 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion"><span>Conclusion</span></a></h2>`,11)),i("p",null,[e[145]||(e[145]=s("You have successfully deployed the ")),e[146]||(e[146]=i("a",{href:"https://aws.amazon.com/marketplace/pp/prodview-jshnzslazfm44",target:"_blank",rel:"noopener noreferrer"},"Zilla Plus for Amazon MSK",-1)),e[147]||(e[147]=s(" Secure Public Access. Instructions on how to Monitor and Upgrade your ")),t(r),e[148]||(e[148]=s(" proxy can be found in the ")),t(p,{to:"/solutions/how-tos/aws-services/manage-cloudformation-stack.html"},{default:a(()=>e[144]||(e[144]=[s("managing a cloudformation stack")])),_:1}),e[149]||(e[149]=s(" section."))])])}const I=k(y,[["render",P],["__file","development.html.vue"]]),R=JSON.parse('{"path":"/solutions/how-tos/amazon-msk/secure-public-access/development.html","title":"Amazon MSK Unauthorized access","lang":"en-US","frontmatter":{"icon":"aky-zilla-plus","description":"Setup connectivity to your Unauthorized access Amazon MSK cluster via the internet.","gitInclude":["../../../_partials/secure-public-access/verify-kafka-connect.md","../../../_partials/secure-public-access/create-topic.md","../../../_partials/secure-public-access/send-message.md"],"head":[["meta",{"property":"og:url","content":"https://docs.aklivity.io/zilla-docs/next/solutions/how-tos/amazon-msk/secure-public-access/development.html"}],["meta",{"property":"og:site_name","content":"Documentation"}],["meta",{"property":"og:title","content":"Amazon MSK Unauthorized access"}],["meta",{"property":"og:description","content":"Setup connectivity to your Unauthorized access Amazon MSK cluster via the internet."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Amazon MSK Unauthorized access\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Overview","slug":"overview","link":"#overview","children":[{"level":3,"title":"AWS services used","slug":"aws-services-used","link":"#aws-services-used","children":[]}]},{"level":2,"title":"Prerequisites","slug":"prerequisites","link":"#prerequisites","children":[{"level":3,"title":"Create the MSK Cluster","slug":"create-the-msk-cluster","link":"#create-the-msk-cluster","children":[]},{"level":3,"title":"Create the  proxy security group","slug":"create-the-proxy-security-group","link":"#create-the-proxy-security-group","children":[]},{"level":3,"title":"Update the default security group rules","slug":"update-the-default-security-group-rules","link":"#update-the-default-security-group-rules","children":[{"level":4,"title":"Add a Custom TCP Rule","slug":"add-a-custom-tcp-rule","link":"#add-a-custom-tcp-rule","children":[]}]},{"level":3,"title":"Create the  proxy IAM security role","slug":"create-the-proxy-iam-security-role","link":"#create-the-proxy-iam-security-role","children":[{"level":4,"title":"IAM role Inline Policies","slug":"iam-role-inline-policies","link":"#iam-role-inline-policies","children":[]}]}]},{"level":2,"title":"Subscribe via AWS Marketplace","slug":"subscribe-via-aws-marketplace","link":"#subscribe-via-aws-marketplace","children":[]},{"level":2,"title":"Create the Server Certificate","slug":"create-the-server-certificate","link":"#create-the-server-certificate","children":[]},{"level":2,"title":"Deploy the Zilla Plus Secure Public Access Proxy","slug":"deploy-the-zilla-plus-secure-public-access-proxy","link":"#deploy-the-zilla-plus-secure-public-access-proxy","children":[{"level":3,"title":"Step 1. Create Stack","slug":"step-1-create-stack","link":"#step-1-create-stack","children":[]},{"level":3,"title":"Step 2. Specify stack details","slug":"step-2-specify-stack-details","link":"#step-2-specify-stack-details","children":[]},{"level":3,"title":"Step 3. Configure stack options: (use defaults)","slug":"step-3-configure-stack-options-use-defaults","link":"#step-3-configure-stack-options-use-defaults","children":[]},{"level":3,"title":"Step 4. Review","slug":"step-4-review","link":"#step-4-review","children":[]}]},{"level":2,"title":"Verify  proxy Service","slug":"verify-proxy-service","link":"#verify-proxy-service","children":[]},{"level":2,"title":"Verify Kafka Client Connectivity","slug":"verify-kafka-client-connectivity","link":"#verify-kafka-client-connectivity","children":[{"level":3,"title":"Install the Kafka Client","slug":"install-the-kafka-client","link":"#install-the-kafka-client","children":[]},{"level":3,"title":"Trust the Private Certificate Authority","slug":"trust-the-private-certificate-authority","link":"#trust-the-private-certificate-authority","children":[]},{"level":3,"title":"Configure the Kafka Client","slug":"configure-the-kafka-client","link":"#configure-the-kafka-client","children":[]},{"level":3,"title":"Configure Local DNS","slug":"configure-local-dns","link":"#configure-local-dns","children":[]},{"level":3,"title":"Test the Kafka Client","slug":"test-the-kafka-client","link":"#test-the-kafka-client","children":[{"level":4,"title":"Create a Topic","slug":"create-a-topic","link":"#create-a-topic","children":[]},{"level":4,"title":"Publish messages","slug":"publish-messages","link":"#publish-messages","children":[]},{"level":4,"title":"Receive messages","slug":"receive-messages","link":"#receive-messages","children":[]}]}]},{"level":2,"title":"Conclusion","slug":"conclusion","link":"#conclusion","children":[]}],"readingTime":{"minutes":7.68,"words":2304},"filePathRelative":"solutions/how-tos/amazon-msk/secure-public-access/development.md"}');export{I as comp,R as data};
