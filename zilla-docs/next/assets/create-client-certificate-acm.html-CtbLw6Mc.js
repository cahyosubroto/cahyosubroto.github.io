import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,f as a,a as l,b as s,d as h,e as p,r as k,o as r}from"./app-BNYstFbe.js";const d={};function c(g,i){const e=k("RouteLink");return r(),t("div",null,[i[3]||(i[3]=a(`<h1 id="create-client-certificate" tabindex="-1"><a class="header-anchor" href="#create-client-certificate"><span>Create Client Certificate</span></a></h1><p>You can use the following script to create a client certificate signed by an AWS Private Certificate Authority and upload the client private key to AWS SecretsManager.</p><details class="hint-container details"><summary>create_client_certificate.sh</summary><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#008000;--shiki-dark:#6A9955;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">while</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> [ </span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">$#</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> -gt </span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;">0</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> ]; </span><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">do</span></span>
<span class="line"><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">    if</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> [[ </span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$1</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> == </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;--&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">* ]]; </span><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">then</span></span>
<span class="line"><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">        v</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">\${1</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">--</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">}</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">        v</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;\${</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">v</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">//</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">-</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">/</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">$&#39;_&#39;}&quot;</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">        declare</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$v</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$2</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">        shift</span></span>
<span class="line"><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">    fi</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    shift</span></span>
<span class="line"><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">done</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">programname</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">=</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;"> usage</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    echo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    echo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;Creates signed client certificate and uploads client private key to SecretsManager&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    echo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    echo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;usage: </span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$programname</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> --client-name string  --acm-pca-certificate-authority string&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    echo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    echo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;  --client-name string                         name of the client&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    echo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;                                               (example: client-1)&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    echo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;  --acm-pca-certificate-authority string       AWS private certificate authority arn&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    echo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;                                               (example: arn:aws:acm-pca:us-east-1..:certificate-authority)&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    echo</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">function</span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;"> die</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> {</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    printf</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;Script failed: %s\\n\\n&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$1</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    exit</span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;"> 1</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">if</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> [[ -z </span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> ]]; </span><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">then</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    usage</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    die</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;Missing parameter --client-name&quot;</span></span>
<span class="line"><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">elif</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> [[ -z </span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$acm_pca_certificate_authority</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> ]]; </span><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">then</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    usage</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">    die</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;Missing parameter --acm-pca-certificate-authority&quot;</span></span>
<span class="line"><span style="--shiki-light:#AF00DB;--shiki-dark:#C586C0;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">set</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -ex</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">openssl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> genrsa</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -out</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;.key.pem</span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;"> 4096</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">openssl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> pkcs8</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -topk8</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -nocrypt</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -in</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;.key.pem</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -out</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;.pkcs8.pem</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">openssl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> req</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -new</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -key</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;.key.pem</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -out</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;.csr</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">aws</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> acm-pca</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> issue-certificate</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --region</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> us-east-1</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --certificate-authority-arn</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$acm_pca_certificate_authority</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --csr</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> fileb://&quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;.csr</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --signing-algorithm</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;SHA256WITHRSA&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --validity</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> Value=365,Type=&quot;DAYS&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --idempotency-token</span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;"> 1234</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &gt; </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">clientCertArn</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">=$(</span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">jq</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -r</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &#39;.CertificateArn&#39;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;.json</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">aws</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> secretsmanager</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> create-secret</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --region</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> us-east-1</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --secret-string</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> file://&quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;.pkcs8.pem</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --tags</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;[{</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">Key</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">:</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">certificate-authority-arn</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">, </span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">Value</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">:</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$acm_pca_certificate_authority</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">}, {</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">Key</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">:</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">certificate-arn</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">, </span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">Value</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">: </span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$clientCertArn</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\&quot;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">}]&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">aws</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> acm-pca</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> get-certificate</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --region</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> us-east-1</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --certificate-arn</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$clientCertArn</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --certificate-authority-arn</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$acm_pca_certificate_authority</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --output</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> text</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> | </span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">sed</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;s/\\t/\\n/g&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &gt; </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$client_name</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;.cert</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h2 id="resource-parameters" tabindex="-1"><a class="header-anchor" href="#resource-parameters"><span>Resource Parameters</span></a></h2><p>The following parameters are needed when following these steps to create a new client certificate using AWS Certificate Manager.</p><ul><li>Common Name</li><li>Private Certificate Authority</li></ul><p>Throughout this guide we use the following example client certificate parameters.</p><ul><li>Client Identity <ul><li>Common Name <code>client-1</code></li></ul></li><li>Private Certificate Authority <ul><li>Name <code>Mutual Authentication CA</code></li></ul></li></ul><h2 id="create-the-certificate-authority" tabindex="-1"><a class="header-anchor" href="#create-the-certificate-authority"><span>Create the Certificate Authority</span></a></h2>`,9)),l("p",null,[i[1]||(i[1]=s("If you do not already have one, follow the ")),h(e,{to:"/solutions/how-tos/aws-services/create-certificate-authority-acm.html"},{default:p(()=>i[0]||(i[0]=[s("Create Certificate Authority")])),_:1}),i[2]||(i[2]=s(" guide to create a new private certificate authority in AWS Certificate Manager."))]),i[4]||(i[4]=a(`<div class="hint-container info"><p class="hint-container-title">Info</p><p>Note the ARN of the private certificate authority.</p></div><h2 id="generate-the-rsa-key" tabindex="-1"><a class="header-anchor" href="#generate-the-rsa-key"><span>Generate the RSA key</span></a></h2><p>We need to create a new key that will be used with the certificate, and store the key in <code>pkcs8</code> format. In this example we will be creating the key for a client certificate with <code>client-1</code> as the common name.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">openssl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> genrsa</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -out</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1.key.pem</span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;"> 4096</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">openssl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> pkcs8</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -topk8</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -nocrypt</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -in</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1.key.pem</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -out</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1.pkcs8.pem</span></span></code></pre></div><h2 id="create-the-signing-request" tabindex="-1"><a class="header-anchor" href="#create-the-signing-request"><span>Create the signing request</span></a></h2><p>Next we need to create a certificate corresponding to the key, with metadata about the owner of the certificate and the common name. This is done by first creating a certificate signing request.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">openssl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> req</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -new</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -key</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1.key.pem</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -out</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> client-1.csr</span></span></code></pre></div><div class="language-output" data-highlighter="shiki" data-ext="output" data-title="output" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>You are about to be asked to enter information that will be incorporated</span></span>
<span class="line"><span>into your certificate request.</span></span>
<span class="line"><span>What you are about to enter is what is called a Distinguished Name or a DN.</span></span>
<span class="line"><span>There are quite a few fields but you can leave some blank</span></span>
<span class="line"><span>For some fields there will be a default value,</span></span>
<span class="line"><span>If you enter &#39;.&#39;, the field will be left blank.</span></span>
<span class="line"><span>-----</span></span>
<span class="line"><span>Country Name (2 letter code) []:US</span></span>
<span class="line"><span>State or Province Name (full name) []:California</span></span>
<span class="line"><span>Locality Name (eg, city) []:Palo Alto</span></span>
<span class="line"><span>Organization Name (eg, company) []:Aklivity</span></span>
<span class="line"><span>Organizational Unit Name (eg, section) []:Development</span></span>
<span class="line"><span>Common Name (eg, fully qualified host name) []:client-1</span></span>
<span class="line"><span>Email Address []:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Please enter the following &#39;extra&#39; attributes</span></span>
<span class="line"><span>to be sent with your certificate request</span></span>
<span class="line"><span>A challenge password []:</span></span>
<span class="line"><span>An optional company name []:</span></span></code></pre></div><div class="hint-container info"><p class="hint-container-title">Info</p><p>This creates the signing request in <code>client-1.csr</code>.</p></div><h2 id="issue-the-signed-certificate" tabindex="-1"><a class="header-anchor" href="#issue-the-signed-certificate"><span>Issue the signed certificate</span></a></h2><p>Now that the certificate signing request has been prepared, it can be used to issue a new certificate signed by your private certificate authority.</p><p>In this example, we issue the certificate to be valid for <code>365 days</code>. You should choose a validity period that best suits your specific use case.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">aws</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> acm-pca</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> issue-certificate</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--region </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">us-east-1</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--certificate-authority-arn &lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">private-certificate-authority-ar</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">n&gt; </span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--csr </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">fileb://client-1.csr</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--signing-algorithm </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;SHA256WITHRSA&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--validity </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">Value=365,Type=&quot;DAYS&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--idempotency-token </span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;">1234</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This command returns the ARN of the newly signed certificate.</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">{</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">    &quot;CertificateArn&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;arn:aws:acm-pca:us-east-1:...:certificate-authority/.../certificate/...&quot;</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">}</span></span></code></pre></div><p>Now the signed certificate can be retrieved from AWS Private Certificate Authority using the .</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">aws</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> acm-pca</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> get-certificate</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--region </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">us-east-1</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--certificate-arn &lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">client-certificate-ar</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">n&gt;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">--certificate-authority-arn</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">private-certificate-authority-ar</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">n&gt;</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">--output</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> text</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> | </span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">sed</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &quot;s/\\t/\\n/g&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &gt; </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">client_1.cert</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This returns the public signed client certificate chain associated with the client private key.</p><h2 id="store-the-encrypted-secret" tabindex="-1"><a class="header-anchor" href="#store-the-encrypted-secret"><span>Store the encrypted secret</span></a></h2><p>Now we need to create the secret value using the <code>pkcs8</code> encoded private key as the secret value and with secret tags <code>certificate-authority-arn</code> referencing the private certificate authority, and <code>certificate-arn</code> referencing the newly signed certificate.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">aws</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> secretsmanager</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> create-secret</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--region </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">us-east-1</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--name </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;client-1&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--secret-string </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">file://client-1.pkcs8.pem</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--tags </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&#39;[{&quot;Key&quot;:&quot;certificate-authority-arn&quot;, &quot;Value&quot;:&quot;arn:aws:acm-pca:us-east-1:...:certificate-authority/...&quot;}, {&quot;Key&quot;:&quot;certificate-arn&quot;, &quot;Value&quot;:&quot;arn:aws:acm-pca:us-east-1:...:certificate-authority/.../certificate/...&quot;}]&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This secret can now be used by the Zilla Plus for Amazon MSK to resolve private keys and their corresponding signed certificates to support TLS client authentication.</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>Note the ARN of the newly created secret for the client certificate&#39;s private key.</p></div><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>In the example above, private certificates are valid for <code>365 days</code>, so you will need to renew the certificate and update the <code>secret-string</code> value and <code>certificate-arn</code> tag accordingly before expiration. The latest secret value and corresponding private certificate are obtained automatically upon restarting the Zilla proxy instance.</p></div>`,24))])}const u=n(d,[["render",c],["__file","create-client-certificate-acm.html.vue"]]),D=JSON.parse('{"path":"/solutions/how-tos/aws-services/create-client-certificate-acm.html","title":"Create Client Certificate","lang":"en-US","frontmatter":{"description":"Create a AWS Certificate Manager client certificate to authenticate Kafka client identity.","gitInclude":[],"head":[["meta",{"property":"og:url","content":"https://docs.aklivity.io/zilla-docs/next/solutions/how-tos/aws-services/create-client-certificate-acm.html"}],["meta",{"property":"og:site_name","content":"Documentation"}],["meta",{"property":"og:title","content":"Create Client Certificate"}],["meta",{"property":"og:description","content":"Create a AWS Certificate Manager client certificate to authenticate Kafka client identity."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Create Client Certificate\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Resource Parameters","slug":"resource-parameters","link":"#resource-parameters","children":[]},{"level":2,"title":"Create the Certificate Authority","slug":"create-the-certificate-authority","link":"#create-the-certificate-authority","children":[]},{"level":2,"title":"Generate the RSA key","slug":"generate-the-rsa-key","link":"#generate-the-rsa-key","children":[]},{"level":2,"title":"Create the signing request","slug":"create-the-signing-request","link":"#create-the-signing-request","children":[]},{"level":2,"title":"Issue the signed certificate","slug":"issue-the-signed-certificate","link":"#issue-the-signed-certificate","children":[]},{"level":2,"title":"Store the encrypted secret","slug":"store-the-encrypted-secret","link":"#store-the-encrypted-secret","children":[]}],"readingTime":{"minutes":3.25,"words":974},"filePathRelative":"solutions/how-tos/aws-services/create-client-certificate-acm.md"}');export{u as comp,D as data};
