import{_ as u}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as k,a as t,b as i,d as s,f as o,e as a,r as d,o as g}from"./app-BNYstFbe.js";const y={},m={class:"zilla-plus-badge hint-container info"},v={href:"https://www.aklivity.io/products/zilla-plus",target:"_blank",rel:"noopener noreferrer"},f={class:"hint-container info"},b={class:"hint-container tip"},D={class:"hint-container info"};function C(w,e){const l=d("ZillaPlus"),p=d("RouteLink"),h=d("CodeTabs"),c=d("Tabs");return g(),k("div",null,[e[63]||(e[63]=t("h1",{id:"redpanda-iot-ingest-and-control",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#redpanda-iot-ingest-and-control"},[t("span",null,"Redpanda IoT Ingest and Control")])],-1)),t("p",m,[t("a",v,[e[0]||(e[0]=i("Available in ")),s(l)])]),e[64]||(e[64]=o('<div class="hint-container info"><p class="hint-container-title">Estimated time to complete 10-15 minutes.</p></div><h2 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h2><p>The <a href="https://aws.amazon.com/marketplace/pp/prodview-sj4kquyndubiu" target="_blank" rel="noopener noreferrer">Zilla Plus for Redpanda</a> IoT Ingest and Control MQTT Broker lets clients publish messages and subscribe to topics that are proxied to Kafka topics in your Redpanda cluster.</p><h2 id="prerequisites" tabindex="-1"><a class="header-anchor" href="#prerequisites"><span>Prerequisites</span></a></h2><p>Before creating an IoT Ingest and Control MQTT Broker to your Kafka cluster, you will need the following:</p><ul><li>a Kafka cluster configured for SASL/SCRAM authentication</li><li>a custom DNS wildcard domain, for this guide we will use <code>*.example.aklivity.io</code></li><li>a TLS Server Certificate stored in Secrets Manager for your custom DNS wildcard domain</li></ul>',6)),t("div",f,[e[6]||(e[6]=t("p",{class:"hint-container-title"},"Info",-1)),e[7]||(e[7]=t("p",null,"Note the server certificate secret ARN as we will need to reference it from the IoT Ingest and Control CloudFormation template.",-1)),e[8]||(e[8]=t("p",null,[i("Make sure you have selected the desired region, ex: "),t("code",null,"US East (N. Virginia) us-east-1"),i(".")],-1)),t("p",null,[e[2]||(e[2]=i("If you need help creating a TLS Server Certificate you can follow the ")),s(p,{to:"/solutions/how-tos/aws-services/create-server-certificate-letsencrypt.html"},{default:a(()=>e[1]||(e[1]=[i("Create Server Certificate with LetsEncrypt")])),_:1}),e[3]||(e[3]=i(" guide. Use your own custom DNS wildcard domain in place of the example domain ")),e[4]||(e[4]=t("code",null,"*.example.aklivity.io",-1)),e[5]||(e[5]=i("."))])]),e[65]||(e[65]=o('<h3 id="aws-services-used" tabindex="-1"><a class="header-anchor" href="#aws-services-used"><span>AWS services used</span></a></h3><table><thead><tr><th>Service</th><th>Required</th><th>Usage</th><th>Quota</th></tr></thead><tbody><tr><td>Secrets Manager</td><td>Yes</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/asm.html#limits_secrets-manager" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr><tr><td>Certificate Manager</td><td>No<br><br>Private key and certificate can be inline in Secrets Manager instead</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/acm.html#limits_acm" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr><tr><td>Private Certificate Manager</td><td>No<br><br>Private key and certificate can be inline in Secrets Manager instead</td><td>Startup only</td><td><a href="https://docs.aws.amazon.com/general/latest/gr/acm-pca.html#limits_acm-pca" target="_blank" rel="noopener noreferrer">Not reached</a></td></tr></tbody></table><p>Default <a href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html" target="_blank" rel="noopener noreferrer">AWS Service Quotas</a> are recommended.</p>',3)),t("div",b,[e[12]||(e[12]=t("p",{class:"hint-container-title"},"Tips",-1)),t("p",null,[e[10]||(e[10]=i("Check out the ")),s(p,{to:"/solutions/how-tos/aws-services/troubleshooting.html"},{default:a(()=>e[9]||(e[9]=[i("Troubleshooting")])),_:1}),e[11]||(e[11]=i(" guide if you run into any issues."))])]),e[66]||(e[66]=o(`<h2 id="create-the-redpanda-cluster" tabindex="-1"><a class="header-anchor" href="#create-the-redpanda-cluster"><span>Create the Redpanda cluster</span></a></h2><blockquote><p>This creates your Redpanda cluster.</p></blockquote><p>The <a href="https://docs.redpanda.com/current/get-started/quick-start-cloud/" target="_blank" rel="noopener noreferrer">Redpanda Cloud Quickstart</a> will walk you through creating one. You can skip this step if you have already created a Redpanda cluster with an equivalent configuration.</p><ul><li><p>Cluster Name: <code>my-zilla-iot-rp-cluster</code></p></li><li><p>Cluster Type: any</p></li><li><p>Create Topics:</p><ul><li>With cleanup policy &quot;delete&quot; to store MQTT messages:</li></ul><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>mqtt-messages</span></span></code></pre></div><ul><li>With cleanup policy &quot;compact&quot; to store MQTT retained messages:</li></ul><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>mqtt-retained</span></span></code></pre></div><ul><li>With cleanup policy &quot;compact&quot; to store MQTT sessions:</li></ul><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>mqtt-sessions</span></span></code></pre></div></li></ul><h3 id="create-an-api-key" tabindex="-1"><a class="header-anchor" href="#create-an-api-key"><span>Create an API key</span></a></h3><p>Follow the Configure Authentication documentation to set up <a href="https://docs.redpanda.com/current/manage/security/authentication/#scram" target="_blank" rel="noopener noreferrer">SASL/SCRAM in Redpanda</a>. Save the username and password for use later.</p><h3 id="create-a-secret-with-sasl-scram-authentication-params" tabindex="-1"><a class="header-anchor" href="#create-a-secret-with-sasl-scram-authentication-params"><span>Create a Secret with SASL/SCRAM authentication params</span></a></h3><blockquote><p>This creates a Secrets Manager secret with the necessary properties to access the Redpanda cluster.</p></blockquote><p>Follow the <a href="https://console.aws.amazon.com/secretsmanager/newsecret" target="_blank" rel="noopener noreferrer">Store a new secret</a> wizard with the following parameters and defaults.</p><ul><li><p>Secret Type: <code>Other type of secret</code></p></li><li><p>Value:</p><ul><li><p>Plaintext JSON object:</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">{</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;sasl_username&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;&lt;rp-username&gt;&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;sasl_password&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;&lt;rp-password&gt;&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;bootstrap_server&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;&lt;rp-bootstrap-server&gt;&quot;</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">}</span></span></code></pre></div></li></ul></li><li><p>Secret Name: <code>my-zilla-iot-access-secret</code></p></li><li><p>Review and store the secret</p></li></ul><h2 id="zilla-proxy-aws-resources" tabindex="-1"><a class="header-anchor" href="#zilla-proxy-aws-resources"><span>Zilla proxy AWS resources</span></a></h2>`,11)),t("p",null,[e[13]||(e[13]=i("We need to create the AWS resources necessary to allow access to the IoT Ingest and Control MQTT Broker from the internet, the ")),s(l),e[14]||(e[14]=i(" proxy instances access to Secrets Manager secrets, and SSH access to the instances for troubleshooting."))]),e[67]||(e[67]=t("h3",{id:"create-the-vpc",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#create-the-vpc"},[t("span",null,"Create the VPC")])],-1)),t("blockquote",null,[t("p",null,[e[15]||(e[15]=i("This creates your ")),s(l),e[16]||(e[16]=i(" proxy VPC in preparation for access from an MQTT client."))])]),e[68]||(e[68]=t("p",null,[t("a",{href:"https://docs.aws.amazon.com/vpc/latest/userguide/create-vpc.html#create-vpc-and-other-resources",target:"_blank",rel:"noopener noreferrer"},"Create a VPC plus other VPC resources"),i(" with the below resource names.")],-1)),e[69]||(e[69]=t("ul",null,[t("li",null,[i("Name tag auto-generation: "),t("code",null,"my-zilla-iot-proxy")]),t("li",null,[i("VPC endpoints: "),t("code",null,"none")]),t("li",null,"Create the VPC")],-1)),e[70]||(e[70]=t("h3",{id:"create-the-security-group",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#create-the-security-group"},[t("span",null,"Create the security group")])],-1)),t("blockquote",null,[t("p",null,[e[17]||(e[17]=i("This creates your ")),s(l),e[18]||(e[18]=i(" proxy security group to allow MQTT clients and SSH access."))])]),t("p",null,[e[19]||(e[19]=i("A VPC security group is needed for the ")),s(l),e[20]||(e[20]=i(" proxies when they are launched."))]),t("p",null,[e[21]||(e[21]=i("Follow the ")),e[22]||(e[22]=t("a",{href:"https://console.aws.amazon.com/vpcconsole/home#CreateSecurityGroup:",target:"_blank",rel:"noopener noreferrer"},"Create Security Group",-1)),e[23]||(e[23]=i(" wizard with the following parameters and defaults. This creates your ")),s(l),e[24]||(e[24]=i(" proxy security group to allow MQTT clients and SSH access."))]),e[71]||(e[71]=o('<div class="hint-container note"><p class="hint-container-title">Check your selected region</p><p>Make sure you have selected the desired region, ex: <code>US East (N. Virginia) us-east-1</code>.</p></div><ul><li>Name: <code>my-zilla-iot-proxy-sg</code></li><li>VPC: <code>my-zilla-iot-proxy-vpc</code></li><li>Description: <code>MQTT clients and SSH access</code></li><li>Add Inbound Rule <ul><li>Type: <code>CUSTOM TCP</code></li><li>Port Range: <code>8883</code></li><li>Source type: <code>Anywhere-IPv4</code></li></ul></li><li>Add Inbound Rule <ul><li>Type: <code>SSH</code></li><li>Source type: <code>My IP</code></li></ul></li><li>Add Outbound Rule (if not exists) <ul><li>Type: <code>All traffic</code></li><li>Destination: <code>Anywhere-IPv4</code></li></ul></li><li>Create the Security Group</li></ul><div class="hint-container warning"><p class="hint-container-title">Check your network settings</p><p>Your IP may be different when you SSH into the EC2 instance. VPNs and other networking infrastructure may cause the <code>My IP</code> inbound rule to fail. Instead, you can use one of the other ways AWS provides to execute commands in an EC2 instance.</p></div><h3 id="create-the-iam-security-role" tabindex="-1"><a class="header-anchor" href="#create-the-iam-security-role"><span>Create the IAM security role</span></a></h3>',4)),t("blockquote",null,[t("p",null,[e[25]||(e[25]=i("This creates an IAM security role to enable the required AWS services for the ")),s(l),e[26]||(e[26]=i(" proxies."))])]),e[72]||(e[72]=o(`<p>Navigate to the <a href="https://console.aws.amazon.com/iamv2/home#/roles/create" target="_blank" rel="noopener noreferrer">Create role</a> form and fill out the form with the following details:</p><ul><li><p>Region: <code>Global</code></p></li><li><p>Trusted Entity Type: <code>AWS Service</code></p></li><li><p>Choose a use case: <code>EC2</code></p></li><li><p>Add Permissions policies</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>AWSCertificateManagerReadOnly</span></span>
<span class="line"><span>AmazonSSMManagedInstanceCore</span></span></code></pre></div></li><li><p>Role Name:</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>my-zilla-iot-role</span></span></code></pre></div></li></ul><p>Click <code>Create role</code></p><p>Open the newly created role</p><ul><li><p>Use the <code>Add permissions</code> &gt; <code>Create Inline Policy</code> action from the dropdown</p></li><li><p>JSON Summary</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">{</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;Version&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;2012-10-17&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">  &quot;Statement&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: [</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">    {</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">      &quot;Sid&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;VisualEditor0&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">      &quot;Effect&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;Allow&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">      &quot;Action&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: [</span></span>
<span class="line"><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">        &quot;secretsmanager:GetSecretValue&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">        &quot;secretsmanager:DescribeSecret&quot;</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">      ],</span></span>
<span class="line"><span style="--shiki-light:#0451A5;--shiki-dark:#9CDCFE;">      &quot;Resource&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: [</span></span>
<span class="line"><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">        &quot;arn:aws:secretsmanager:*:*:secret:&lt;TLS certificate private key secret name&gt;*&quot;</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">,</span></span>
<span class="line"><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">        &quot;arn:aws:secretsmanager:*:*:secret:&lt;SASL/SCRAM auth secret name&gt;*&quot;</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">      ]</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">    }</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">  ]</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">}</span></span></code></pre></div></li></ul><div class="hint-container info"><p class="hint-container-title">If you used a different secret name.</p><p>The IAM role Inline policy uses the Secrets Manager ARN regex pattern <code>arn:aws:secretsmanager:*:*:secret:&lt;Secret Name&gt;*</code>. Make sure you replace the resources listed with the appropriate patterns.</p></div><ul><li><p>Name</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>MyZillaIotProxySecretsManagerRead</span></span></code></pre></div></li></ul><h2 id="subscribe-via-aws-marketplace" tabindex="-1"><a class="header-anchor" href="#subscribe-via-aws-marketplace"><span>Subscribe via AWS Marketplace</span></a></h2><p>The <a href="https://aws.amazon.com/marketplace/pp/prodview-sj4kquyndubiu" target="_blank" rel="noopener noreferrer">Zilla Plus for Redpanda</a> is available through the AWS Marketplace. You can skip this step if you have already subscribed to Zilla Plus for Redpanda via the AWS Marketplace.</p><p>To get started, visit the Proxy&#39;s Marketplace <a href="https://aws.amazon.com/marketplace/pp/prodview-sj4kquyndubiu" target="_blank" rel="noopener noreferrer">Product Page</a> and <code>Subscribe</code> to the offering. You should now see <code>Zilla Plus for Redpanda</code> listed in your <a href="https://console.aws.amazon.com/marketplace" target="_blank" rel="noopener noreferrer">AWS Marketplace</a> subscriptions.</p><h2 id="deploy-the-iot-ingest-and-control-mqtt-broker" tabindex="-1"><a class="header-anchor" href="#deploy-the-iot-ingest-and-control-mqtt-broker"><span>Deploy the IoT Ingest and Control MQTT Broker</span></a></h2><blockquote><p>This initiates deployment of the Zilla Plus for Redpanda stack via CloudFormation.</p></blockquote><p>Navigate to your <a href="https://console.aws.amazon.com/marketplace" target="_blank" rel="noopener noreferrer">AWS Marketplace</a> subscriptions and select <code>Zilla Plus for Redpanda</code> to show the manage subscription page.</p><ul><li>From the <code>Agreement</code> section &gt; <code>Actions</code> menu &gt; select <code>Launch CloudFormation stack</code></li><li>Select the <code>CloudFormation Template</code> &gt; <code>IoT Ingest and Control</code> fulfillment option</li><li>Make sure you have selected the desired region selected, such as <code>us-east-1</code></li><li>Click <code>Continue to Launch</code><ul><li>Choose the action <code>Launch CloudFormation</code></li></ul></li></ul><p>Click <code>Launch</code> to complete the <code>Create stack</code> wizard with the following details:</p><h3 id="step-1-create-stack" tabindex="-1"><a class="header-anchor" href="#step-1-create-stack"><span>Step 1. Create Stack</span></a></h3><ul><li>Prepare template: <code>Template is ready</code></li><li>Specify template: <code>Amazon S3 URL</code><ul><li>Amazon S3 URL: <code>(auto-filled)</code></li></ul></li></ul><h3 id="step-2-specify-stack-details" tabindex="-1"><a class="header-anchor" href="#step-2-specify-stack-details"><span>Step 2. Specify stack details</span></a></h3>`,18)),s(h,{id:"511",data:[{id:"Stack name"}]},{title0:a(({value:n,isActive:r})=>e[27]||(e[27]=[i("Stack name")])),tab0:a(({value:n,isActive:r})=>e[28]||(e[28]=[t("div",{class:"language-text","data-highlighter":"shiki","data-ext":"text","data-title":"text",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[t("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[t("code",null,[t("span",{class:"line"},[t("span",null,"my-zilla-iot-proxy")])])])],-1)])),_:1}),e[73]||(e[73]=t("p",null,"Parameters:",-1)),t("ul",null,[e[37]||(e[37]=o("<li>Network Configuration <ul><li>VPC: <code>my-zilla-iot-proxy-vpc</code></li><li>Subnets: <code>my-zilla-iot-proxy-subnet-public-1a</code> <code>my-zilla-iot-proxy-subnet-public-1b</code></li></ul></li><li>Redpanda Configuration <ul><li>Access Credentials and Bootstrap Server Secret ARN: <code>&lt;my-zilla-iot-access-secret secret ARN&gt;</code> *1</li><li>Kafka Topics: <ul><li>messages: <code>mqtt-messages</code></li><li>retained: <code>mqtt-retained</code></li><li>sessions: <code>mqtt-sessions</code></li></ul></li></ul></li><li>Zilla Plus Configuration <ul><li>Instance count: <code>2</code></li><li>Instance type: <code>t3.small</code> *2</li><li>Role: <code>my-zilla-iot-role</code></li><li>Security Groups: <code>my-zilla-iot-proxy-sg</code></li><li>Public Port: <code>8883</code></li><li>Public Wildcard DNS: <code>*.example.aklivity.io</code> *3</li><li>Public TLS Certificate Key: <code>&lt;TLS certificate private key secret ARN&gt;</code> *4</li><li>Key pair for SSH access: <code>my-key-pair</code> *5</li></ul></li>",3)),t("li",null,[e[36]||(e[36]=i("*Configuration Reference ")),t("ol",null,[e[32]||(e[32]=t("li",null,[i("This is the ARN for the secret created in the "),t("a",{href:"#create-a-secret-with-sasl-scram-authentication-params"},"Create a Secret with SASL/SCRAM authentication params"),i(" step of this guide.")],-1)),e[33]||(e[33]=t("li",null,"Consider the network throughput characteristics of the AWS instance type as that will impact the upper bound on network performance.",-1)),e[34]||(e[34]=t("li",null,[i("Replace with your own custom wildcard DNS pattern mentioned in the "),t("a",{href:"#prerequisites"},"Prerequisites"),i(" of this guide.")],-1)),e[35]||(e[35]=t("li",null,[i("This is the ARN of the created secret for the signed certificate's private key mentioned in the "),t("a",{href:"#prerequisites"},"Prerequisites"),i(" of this guide.")],-1)),t("li",null,[e[30]||(e[30]=i("Follow the ")),s(p,{to:"/solutions/how-tos/aws-services/create-key-pair.html"},{default:a(()=>e[29]||(e[29]=[i("Create Key Pair")])),_:1}),e[31]||(e[31]=i(" guide to create a new key pair to access EC2 instances via SSH."))])])])]),e[74]||(e[74]=t("h3",{id:"step-3-configure-stack-options-use-defaults",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#step-3-configure-stack-options-use-defaults"},[t("span",null,[i("Step 3. Configure stack options: "),t("code",null,"(use defaults)")])])],-1)),e[75]||(e[75]=t("h3",{id:"step-4-review",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#step-4-review"},[t("span",null,"Step 4. Review")])],-1)),e[76]||(e[76]=t("p",null,[i("Confirm the stack details are correct and "),t("code",null,"Submit"),i(" to start the CloudFormation deploy.")],-1)),t("div",D,[e[44]||(e[44]=t("p",{class:"hint-container-title"},"Info",-1)),t("p",null,[e[38]||(e[38]=i("When your ")),s(l),e[39]||(e[39]=i(" proxy is ready, the ")),e[40]||(e[40]=t("a",{href:"https://console.aws.amazon.com/cloudformation",target:"_blank",rel:"noopener noreferrer"},"CloudFormation console",-1)),e[41]||(e[41]=i(" will show ")),e[42]||(e[42]=t("code",null,"CREATE_COMPLETE",-1)),e[43]||(e[43]=i(" for the newly created stack."))])]),e[77]||(e[77]=t("h3",{id:"configure-global-dns",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#configure-global-dns"},[t("span",null,"Configure Global DNS")])],-1)),t("blockquote",null,[t("p",null,[e[45]||(e[45]=i("This enables MQTT clients to connect to the ")),s(l),e[46]||(e[46]=i(" proxy via your custom DNS wildcard domain."))])]),e[78]||(e[78]=o(`<p>When using a wildcard DNS name for your own domain, such as <code>*.example.aklivity.io</code> then the DNS entries are setup in your DNS provider.</p><p>Navigate to the <a href="https://console.aws.amazon.com/cloudformation" target="_blank" rel="noopener noreferrer">CloudFormation console</a>. Then select the <code>my-zilla-iot-proxy</code> stack to show the details.</p><p>In the stack <code>Outputs</code> tab, find the public DNS name of the <code>NetworkLoadBalancer</code>. You need to create a <code>CNAME</code> record mapping your public DNS wildcard pattern to the public DNS name of the Network Load Balancer.</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>You might prefer to use an Elastic IP address for each NLB public subnet, providing DNS targets for your <code>CNAME</code> record that can remain stable even after restarting the stack.</p><p>For testing purposes you can edit your local <code>/etc/hosts</code> file instead of updating your DNS provider.</p></div><h2 id="verify-mqtt-client-connectivity" tabindex="-1"><a class="header-anchor" href="#verify-mqtt-client-connectivity"><span>Verify MQTT Client Connectivity</span></a></h2><p>We need to verify that an MQTT client can publish and subscribe to topics and ensure the messages get routed through your Kafka cluster.</p><h3 id="connect-with-an-mqtt-client" tabindex="-1"><a class="header-anchor" href="#connect-with-an-mqtt-client"><span>Connect with an MQTT Client</span></a></h3><blockquote><p>This verifies MQTT client connectivity to your Kafka cluster via the IoT Ingest and Control MQTT Broker.</p></blockquote><p>We can now verify that the MQTT client can successfully communicate with your Kafka cluster.</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Replace these TLS server names accordingly for your own custom wildcard DNS pattern.</p></div><h3 id="subscribe-to-a-topic" tabindex="-1"><a class="header-anchor" href="#subscribe-to-a-topic"><span>Subscribe to a topic</span></a></h3><p>Using <a href="https://hub.docker.com/_/eclipse-mosquitto" target="_blank" rel="noopener noreferrer">eclipse-mosquitto</a> subscribe to the <code>zilla</code> topic.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">docker</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> run</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -it</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --rm</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> eclipse-mosquitto</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">mosquitto_sub </span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">--url</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> mqtts://mqtt.example.aklivity.io/zilla</span></span></code></pre></div><h3 id="publish-to-a-topic" tabindex="-1"><a class="header-anchor" href="#publish-to-a-topic"><span>Publish to a topic</span></a></h3><p>In a separate session, publish a message on the <code>zilla</code> topic.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">docker</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> run</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -it</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --rm</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> eclipse-mosquitto</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">mosquitto_pub </span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">--url</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> mqtts://mqtt.example.aklivity.io/zilla</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --message</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> &#39;Hello, world&#39;</span></span></code></pre></div><p>You should see the <code>Hello, world</code> message printed by the subscriber.</p><h2 id="verify-the-zilla-proxy-service" tabindex="-1"><a class="header-anchor" href="#verify-the-zilla-proxy-service"><span>Verify the Zilla proxy Service</span></a></h2><blockquote><p>This checks that the services and networking were properly configured. These checks aren&#39;t necessary if the service is running as expected.</p></blockquote><p>Navigate to the <a href="https://console.aws.amazon.com/ec2/home#Instances:instanceState=running" target="_blank" rel="noopener noreferrer">EC2 running instances dashboard.</a></p><div class="hint-container note"><p class="hint-container-title">Check your selected region</p><p>Make sure you have selected the desired region, ex: <code>US East (N. Virginia) us-east-1</code>.</p></div>`,21)),t("p",null,[e[47]||(e[47]=i("Select either of the ")),s(l),e[48]||(e[48]=i(" proxies launched by the CloudFormation template to show the details."))]),e[79]||(e[79]=o('<div class="hint-container info"><p class="hint-container-title">Info</p><p>They each have an IAM Role name starting with <code>my-zilla-iot-role</code>.</p></div><p>Find the <code>Public IPv4 Address</code> and then SSH into the instance.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">ssh</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -i</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> ~/.ssh/</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">key-pair.ce</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">r&gt; </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">ec2-user@</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">&lt;</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">instance-public-ip-addres</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">s&gt;</span></span></code></pre></div><p>After logging in via SSH, check the status of the <code>zilla-plus</code> system service.</p>',4)),s(c,{id:"767",data:[{id:"Service is running"},{id:"Check Ports"},{id:"Check Zilla Logs"},{id:"Check Cloud Init Logs"}]},{title0:a(({value:n,isActive:r})=>e[49]||(e[49]=[i("Service is running")])),title1:a(({value:n,isActive:r})=>e[50]||(e[50]=[i("Check Ports")])),title2:a(({value:n,isActive:r})=>e[51]||(e[51]=[i("Check Zilla Logs")])),title3:a(({value:n,isActive:r})=>e[52]||(e[52]=[i("Check Cloud Init Logs")])),tab0:a(({value:n,isActive:r})=>e[53]||(e[53]=[t("p",null,[i("Verify that the "),t("code",null,"zilla-plus"),i(" service is active and logging output similar to that shown below.")],-1),t("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[t("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"systemctl"),t("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," status"),t("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," zilla-plus.service")])])])],-1),t("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[t("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[t("code",null,[t("span",{class:"line"},[t("span",null,"zilla-plus.service - Zilla Plus")]),i(`
`),t("span",{class:"line"},[t("span",null,"   Loaded: loaded (/etc/systemd/system/zilla-plus.service; enabled; vendor preset: disabled)")]),i(`
`),t("span",{class:"line"},[t("span",null,"   Active: active (running) since...")])])])],-1)])),tab1:a(({value:n,isActive:r})=>e[54]||(e[54]=[t("p",null,[i("Check for the active ports with "),t("code",null,"netstat"),i(".")],-1),t("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[t("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"netstat"),t("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -ntlp")])])])],-1),t("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[t("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[t("code",null,[t("span",{class:"line"},[t("span",null,"tcp6    0    0 :::9092    :::*    LISTEN    1726/.zpm/image/bin")])])])],-1)])),tab2:a(({value:n,isActive:r})=>e[55]||(e[55]=[t("p",null,[i("You can get an stdout dump of the "),t("code",null,"zilla-plus.service"),i(" using "),t("code",null,"journalctl"),i(".")],-1),t("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[t("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"journalctl"),t("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -e"),t("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -u"),t("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," zilla-plus.service"),t("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}}," | "),t("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"tee"),t("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#569CD6"}}," -a"),t("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," /tmp/zilla.log")])])])],-1),t("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[t("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[t("code",null,[t("span",{class:"line"},[t("span",null,"systemd[1]: Started zilla-plus.service - Zilla Plus.")]),i(`
`),t("span",{class:"line"},[t("span",null,"...")])])])],-1)])),tab3:a(({value:n,isActive:r})=>e[56]||(e[56]=[t("p",null,[i("All output from cloud-init is captured by default to "),t("code",null,"/var/log/cloud-init-output.log"),i(". There shouldn't be any errors in this log.")],-1),t("div",{class:"language-bash","data-highlighter":"shiki","data-ext":"bash","data-title":"bash",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[t("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[t("code",null,[t("span",{class:"line"},[t("span",{style:{"--shiki-light":"#795E26","--shiki-dark":"#DCDCAA"}},"cat"),t("span",{style:{"--shiki-light":"#A31515","--shiki-dark":"#CE9178"}}," /var/log/cloud-init-output.log")])])])],-1),t("div",{class:"language-output","data-highlighter":"shiki","data-ext":"output","data-title":"output",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[t("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[t("code",null,[t("span",{class:"line"},[t("span",null,"Cloud-init v. 22.2.2 running 'init'...")])])])],-1)])),_:1}),e[80]||(e[80]=t("h2",{id:"conclusion",tabindex:"-1"},[t("a",{class:"header-anchor",href:"#conclusion"},[t("span",null,"Conclusion")])],-1)),t("p",null,[e[58]||(e[58]=i("You have successfully deployed the ")),e[59]||(e[59]=t("a",{href:"https://aws.amazon.com/marketplace/pp/prodview-sj4kquyndubiu",target:"_blank",rel:"noopener noreferrer"},"Zilla Plus for Redpanda",-1)),e[60]||(e[60]=i(" IoT Ingest and Control MQTT Broker. Instructions on how to Monitor and Upgrade your ")),s(l),e[61]||(e[61]=i(" proxy can be found in the ")),s(p,{to:"/solutions/how-tos/aws-services/manage-cloudformation-stack.html"},{default:a(()=>e[57]||(e[57]=[i("managing a cloudformation stack")])),_:1}),e[62]||(e[62]=i(" section."))])])}const A=u(y,[["render",C],["__file","iot-ingest-control.html.vue"]]),E=JSON.parse('{"path":"/solutions/how-tos/redpanda/iot-ingest-control.html","title":"Redpanda IoT Ingest and Control","lang":"en-US","frontmatter":{"icon":"aky-zilla-plus","description":"Set up an IoT Ingest and Control MQTT Broker that lets clients publish messages and subscribe to topics proxied to Kafka topics in your Redpanda cluster.","gitInclude":["../../_partials/iot-ingest-control/prerequisites.md","../../_partials/iot-ingest-control/aws-resources.md","../../_partials/iot-ingest-control/cf-stack/s1-launch.md","../../_partials/iot-ingest-control/cf-stack/s3-create.md","../../_partials/iot-ingest-control/configure-global-dns.md","../../_partials/iot-ingest-control/verify-mqtt-client-connectivity.md","../../_partials/zilla-plus-proxy/verify-zilla-plus-proxy-service.md"],"head":[["meta",{"property":"og:url","content":"https://docs.aklivity.io/zilla-docs/next/solutions/how-tos/redpanda/iot-ingest-control.html"}],["meta",{"property":"og:site_name","content":"Documentation"}],["meta",{"property":"og:title","content":"Redpanda IoT Ingest and Control"}],["meta",{"property":"og:description","content":"Set up an IoT Ingest and Control MQTT Broker that lets clients publish messages and subscribe to topics proxied to Kafka topics in your Redpanda cluster."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redpanda IoT Ingest and Control\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Overview","slug":"overview","link":"#overview","children":[]},{"level":2,"title":"Prerequisites","slug":"prerequisites","link":"#prerequisites","children":[{"level":3,"title":"AWS services used","slug":"aws-services-used","link":"#aws-services-used","children":[]}]},{"level":2,"title":"Create the Redpanda cluster","slug":"create-the-redpanda-cluster","link":"#create-the-redpanda-cluster","children":[{"level":3,"title":"Create an API key","slug":"create-an-api-key","link":"#create-an-api-key","children":[]},{"level":3,"title":"Create a Secret with SASL/SCRAM authentication params","slug":"create-a-secret-with-sasl-scram-authentication-params","link":"#create-a-secret-with-sasl-scram-authentication-params","children":[]}]},{"level":2,"title":"Zilla proxy AWS resources","slug":"zilla-proxy-aws-resources","link":"#zilla-proxy-aws-resources","children":[{"level":3,"title":"Create the VPC","slug":"create-the-vpc","link":"#create-the-vpc","children":[]},{"level":3,"title":"Create the security group","slug":"create-the-security-group","link":"#create-the-security-group","children":[]},{"level":3,"title":"Create the IAM security role","slug":"create-the-iam-security-role","link":"#create-the-iam-security-role","children":[]}]},{"level":2,"title":"Subscribe via AWS Marketplace","slug":"subscribe-via-aws-marketplace","link":"#subscribe-via-aws-marketplace","children":[]},{"level":2,"title":"Deploy the IoT Ingest and Control MQTT Broker","slug":"deploy-the-iot-ingest-and-control-mqtt-broker","link":"#deploy-the-iot-ingest-and-control-mqtt-broker","children":[{"level":3,"title":"Step 1. Create Stack","slug":"step-1-create-stack","link":"#step-1-create-stack","children":[]},{"level":3,"title":"Step 2. Specify stack details","slug":"step-2-specify-stack-details","link":"#step-2-specify-stack-details","children":[]},{"level":3,"title":"Step 3. Configure stack options: (use defaults)","slug":"step-3-configure-stack-options-use-defaults","link":"#step-3-configure-stack-options-use-defaults","children":[]},{"level":3,"title":"Step 4. Review","slug":"step-4-review","link":"#step-4-review","children":[]},{"level":3,"title":"Configure Global DNS","slug":"configure-global-dns","link":"#configure-global-dns","children":[]}]},{"level":2,"title":"Verify MQTT Client Connectivity","slug":"verify-mqtt-client-connectivity","link":"#verify-mqtt-client-connectivity","children":[{"level":3,"title":"Connect with an MQTT Client","slug":"connect-with-an-mqtt-client","link":"#connect-with-an-mqtt-client","children":[]},{"level":3,"title":"Subscribe to a topic","slug":"subscribe-to-a-topic","link":"#subscribe-to-a-topic","children":[]},{"level":3,"title":"Publish to a topic","slug":"publish-to-a-topic","link":"#publish-to-a-topic","children":[]}]},{"level":2,"title":"Verify the Zilla proxy Service","slug":"verify-the-zilla-proxy-service","link":"#verify-the-zilla-proxy-service","children":[]},{"level":2,"title":"Conclusion","slug":"conclusion","link":"#conclusion","children":[]}],"readingTime":{"minutes":2.45,"words":736},"filePathRelative":"solutions/how-tos/redpanda/iot-ingest-control.md"}');export{A as comp,E as data};
