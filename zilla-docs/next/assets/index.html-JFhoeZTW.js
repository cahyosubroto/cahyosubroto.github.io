import{_ as d}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as o,f as t,a as i,b as a,d as l,e,r as h,o as g}from"./app-2pbKPq8C.js";const c={};function u(y,s){const n=h("RouteLink"),r=h("CodeTabs");return g(),o("div",null,[s[32]||(s[32]=t(`<h1 id="deploy-and-operate-zilla" tabindex="-1"><a class="header-anchor" href="#deploy-and-operate-zilla"><span>Deploy and Operate Zilla</span></a></h1><h2 id="install-on-macos-via-homebrew" tabindex="-1"><a class="header-anchor" href="#install-on-macos-via-homebrew"><span>Install on MacOS via Homebrew</span></a></h2><p>You can install Zilla using our <a href="https://github.com/aklivity/homebrew-tap" target="_blank" rel="noopener noreferrer">homebrew tap</a>.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">brew</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> tap</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> aklivity/tap</span></span>
<span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">brew</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> install</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla</span></span></code></pre></div><p>Now you can run any <code>zilla.yaml</code> config.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">zilla</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> start</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -ve</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -c</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> ./zilla.yaml</span></span></code></pre></div><h2 id="running-zilla-via-docker" tabindex="-1"><a class="header-anchor" href="#running-zilla-via-docker"><span>Running Zilla via Docker</span></a></h2>`,7)),i("p",null,[s[1]||(s[1]=a("You can run your ")),s[2]||(s[2]=i("code",null,"zilla.yaml",-1)),s[3]||(s[3]=a(" config inside a container. If you want to deploy on Kubernetes, use our ")),l(n,{to:"/how-tos/deploy-operate/"},{default:e(()=>s[0]||(s[0]=[a("helm chart")])),_:1}),s[4]||(s[4]=a("."))]),s[33]||(s[33]=t(`<div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">docker</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> run</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -v</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> ./zilla.yaml:/etc/zilla/zilla.yaml</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> ghcr.io/aklivity/zilla:latest</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> start</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -ve</span></span></code></pre></div><h2 id="deploying-zilla-via-helm" tabindex="-1"><a class="header-anchor" href="#deploying-zilla-via-helm"><span>Deploying Zilla via Helm</span></a></h2><p>Go to the <a href="https://artifacthub.io/packages/helm/zilla/zilla" target="_blank" rel="noopener noreferrer">Zilla artifacthub</a> page to learn more about installing Zilla using Helm.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">helm</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> install</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> oci://ghcr.io/aklivity/charts/zilla</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --namespace</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> zilla</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --create-namespace</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --wait</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--values </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">values.yaml</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--set-file </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">zilla</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\\\</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">.yaml=zilla.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The Zilla configuration is in the <code>zilla.yaml</code> file, which is added to the Helm install using the <code>--set-file zilla\\\\.yaml=zilla.yaml</code> argument.</p><h3 id="mapping-tcp-ports-through-the-official-ingress-nginx-ingress-controller" tabindex="-1"><a class="header-anchor" href="#mapping-tcp-ports-through-the-official-ingress-nginx-ingress-controller"><span>Mapping TCP ports through the official <code>ingress-nginx</code> ingress controller</span></a></h3><p>You can define your TCP ports to services mapping in a <code>tcp-services</code> ConfigMap. Official documentation on this method can be found in the <a href="https://kubernetes.github.io/ingress-nginx/user-guide/exposing-tcp-udp-services/" target="_blank" rel="noopener noreferrer">Exposing TCP and UDP services</a> guide.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">kubectl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> create</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> configmap</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> tcp-services</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --from-literal=7183=</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$NAMESPACE</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">/</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$SERVICE_NAME</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">:7183&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  --from-literal=7151=</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$NAMESPACE</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">/</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$SERVICE_NAME</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">:7151&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;">  -n</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> ingress-nginx</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -o</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> yaml</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --dry-run=client</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> | </span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">kubectl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> apply</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -f</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> -</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You will need to download the YAML manifest for the ingress controller. You can find an example on the <a href="https://kubernetes.github.io/ingress-nginx/deploy/#quick-start" target="_blank" rel="noopener noreferrer">Ingress Nginx Quickstart guide</a></p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">curl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.10.1/deploy/static/provider/cloud/deploy.yaml</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> &gt; </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">ingress-deploy.yaml</span></span></code></pre></div><p>Once you have the Ingress Nginx YAML manifest, you must add the TCP port proxies for the ingress controller to allow your ports to pass through.</p><p>Here is how to add ports <code>7183</code> and <code>7151</code> to the <code>service/ingress-nginx-controller</code>.</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">kind</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#0000FF;--shiki-dark:#CE9178;">Service</span></span>
<span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">metadata</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">:</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">...</span></span>
<span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">  name</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#0000FF;--shiki-dark:#CE9178;">ingress-nginx-controller</span></span>
<span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">  namespace</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#0000FF;--shiki-dark:#CE9178;">ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">spec</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">:</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">...</span></span>
<span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">  ports</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">:</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">...</span></span>
<span class="line highlighted"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> - </span><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">name</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#0000FF;--shiki-dark:#CE9178;">proxied-tcp-7183</span></span>
<span class="line highlighted"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">    port</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;">7183</span></span>
<span class="line highlighted"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">    targetPort</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;">7183</span></span>
<span class="line highlighted"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">    protocol</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#0000FF;--shiki-dark:#CE9178;">TCP</span></span>
<span class="line highlighted"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> - </span><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">name</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#0000FF;--shiki-dark:#CE9178;">proxied-tcp-7151</span></span>
<span class="line highlighted"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">    port</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;">7151</span></span>
<span class="line highlighted"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">    targetPort</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#098658;--shiki-dark:#B5CEA8;">7151</span></span>
<span class="line highlighted"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">    protocol</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#0000FF;--shiki-dark:#CE9178;">TCP</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Finally, we need to configure the Ingress Nginx controller to look for port mappings in the <code>tcp-services</code> by adding the <code>--tcp-services-configmap=$(POD_NAMESPACE)/tcp-services</code> argument to the Deployment container args.</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">kind</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">: </span><span style="--shiki-light:#0000FF;--shiki-dark:#CE9178;">Deployment</span></span>
<span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">spec</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">:</span></span>
<span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">  template</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">:</span></span>
<span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">    spec</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">:</span></span>
<span class="line"><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">      containers</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">:</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> - </span><span style="--shiki-light:#800000;--shiki-dark:#569CD6;">args</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">:</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">  - </span><span style="--shiki-light:#0000FF;--shiki-dark:#CE9178;">/nginx-ingress-controller</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">...</span></span>
<span class="line highlighted"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">  - </span><span style="--shiki-light:#0000FF;--shiki-dark:#CE9178;">--tcp-services-configmap=$(POD_NAMESPACE)/tcp-services</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Create the ingress controller:</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">kubectl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> apply</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -f</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> ingress-deploy.yaml</span></span></code></pre></div><p>The ingress controller will allow your ports to pass through, and you can configure which services should receive the requests made at those ports.</p><h3 id="adding-files-to-the-zilla-pod" tabindex="-1"><a class="header-anchor" href="#adding-files-to-the-zilla-pod"><span>Adding files to the Zilla pod</span></a></h3><p>All local files referenced in a <code>zilla.yaml</code> config should be found in a location relative to the Zilla install location <code>/etc/zilla</code>. The best way to get your files into a pod is by using configmaps. Below you will find one option using configmaps and volume mounts to add your files into the Zilla pod.</p><ul><li><p>From a single file.</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">kubectl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> create</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> configmap</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> my-files-configmap</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --from-file=my-file.txt</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -n</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;"> $NAMESPACE</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -o</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> yaml</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --dry-run=client</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> | </span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">kubectl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> apply</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -f</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> -</span></span></code></pre></div></li><li><p>All files in a folder. This does not add folders recursively and each folder needs to be individually mapped</p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">kubectl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> create</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> configmap</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> my-folder-configmap</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --from-file=path/to/my-folder/</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -n</span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;"> $NAMESPACE</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -o</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> yaml</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --dry-run=client</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;"> | </span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">kubectl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> apply</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -f</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> -</span></span></code></pre></div></li></ul><p>Once you have the files you need stored in a configmap you can mount them as volumes into the Zilla pod at the install location <code>/etc/zilla</code>.</p><p>:::</p>`,23)),l(r,{id:"86",data:[{id:"values.yaml"}],"tab-id":"bash"},{title0:e(({value:p,isActive:k})=>s[5]||(s[5]=[a("values.yaml")])),tab0:e(({value:p,isActive:k})=>s[6]||(s[6]=[i("div",{class:"language-yaml line-numbers-mode","data-highlighter":"shiki","data-ext":"yaml","data-title":"yaml",style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4","--shiki-light-bg":"#FFFFFF","--shiki-dark-bg":"#1E1E1E"}},[i("pre",{class:"shiki shiki-themes light-plus dark-plus vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"...")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"volumeMounts"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},":")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"  - "),i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"name"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#CE9178"}},"my-files-volume")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"    mountPath"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#CE9178"}},"/etc/zilla/files")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"  - "),i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"name"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#CE9178"}},"my-folder-volume")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"    mountPath"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#CE9178"}},"/etc/zilla/folder")]),a(`
`),i("span",{class:"line"}),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"volumes"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},":")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"  - "),i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"name"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#CE9178"}},"my-files-volume")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"    configMap"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},":")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"      name"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#CE9178"}},"my-files-configmap")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},"  - "),i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"name"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#CE9178"}},"my-folder-volume")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"    configMap"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},":")]),a(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#800000","--shiki-dark":"#569CD6"}},"      name"),i("span",{style:{"--shiki-light":"#000000","--shiki-dark":"#D4D4D4"}},": "),i("span",{style:{"--shiki-light":"#0000FF","--shiki-dark":"#CE9178"}},"my-folder-configmap")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1)])),_:1}),s[34]||(s[34]=t(`<h3 id="get-diagnostics-from-zilla-pods" tabindex="-1"><a class="header-anchor" href="#get-diagnostics-from-zilla-pods"><span>Get diagnostics from Zilla pods</span></a></h3><p>For every running Zilla pod you will need to first copy the <code>/var/run/zilla</code> directory to make sure no additional files are written while it is compressed then compress the full directory to make it easier to copy.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">kubectl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> get</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> pod</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">-l </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;app.kubernetes.io/name=zilla&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">-n </span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$NAMESPACE</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--field-selector=status.phase=Running </span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">-o </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">custom-columns=name:metadata.name</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --no-headers</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">| </span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">xargs</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -I</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">{} kubectl exec {} -n $NAMESPACE -c zilla -- sh -c &quot;cp -r /var/run/zilla /tmp/zilla &amp;&amp; tar czf /tmp/zilla.tar.gz /tmp/zilla &amp;&amp; rm -rf /tmp/zilla&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Copy the compressed <code>/var/run/zilla</code> directory off of the pod into your local directory using the pod name.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">kubectl</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> get</span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;"> pod</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">-l </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">&quot;app.kubernetes.io/name=zilla&quot;</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">-n </span><span style="--shiki-light:#001080;--shiki-dark:#9CDCFE;">$NAMESPACE</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">--field-selector=status.phase=Running </span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;">\\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">-o </span><span style="--shiki-light:#A31515;--shiki-dark:#CE9178;">custom-columns=name:metadata.name</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> --no-headers</span><span style="--shiki-light:#EE0000;--shiki-dark:#D7BA7D;"> \\</span></span>
<span class="line"><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">| </span><span style="--shiki-light:#795E26;--shiki-dark:#DCDCAA;">xargs</span><span style="--shiki-light:#0000FF;--shiki-dark:#569CD6;"> -I</span><span style="--shiki-light:#000000;--shiki-dark:#D4D4D4;">{} kubectl cp  -n $NAMESPACE {}:/tmp/zilla.tar.gz ./{}.tar.gz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Now you have a copy of the Zilla runtime directory for each running pod. This information can be used to diagnose all of the traffic zilla has managed.</p><h2 id="auto-reconfigure" tabindex="-1"><a class="header-anchor" href="#auto-reconfigure"><span>Auto Reconfigure</span></a></h2><p>Zilla loads the configuration from the <code>zilla.yaml</code> file on startup and logs the configured settings. Restarting Zilla or its container may not be an option, so Zilla creates a file watcher to detect changes to the file and reloads the config if a change is detected.</p><p>Errors and misconfigured parts of the <code>zilla.yaml</code> file are detected by Zilla and reported via stdout. The original config remains in place and can only be replaced by a valid config.</p><p>This feature is demonstrated in the above Helm install command. Running a <code>helm update ...</code> with changes to the <code>zilla.yaml</code>, k8s will update the config map, which writes the new content into the running pods. Zilla will detect those file changes and load the new config.</p>`,10)),i("p",null,[s[8]||(s[8]=a("Zilla can load the ")),s[9]||(s[9]=i("code",null,"zilla.yaml",-1)),s[10]||(s[10]=a(" config from a remote source using the ")),s[11]||(s[11]=i("code",null,"-c",-1)),s[12]||(s[12]=a(" or ")),s[13]||(s[13]=i("code",null,"--config",-1)),s[14]||(s[14]=a()),l(n,{to:"/reference/config/zilla-cli.html#c-config"},{default:e(()=>s[7]||(s[7]=[a("CLI flag")])),_:1}),s[15]||(s[15]=a(". The auto reconfigure feature will still work when pulling the config remotely."))]),s[35]||(s[35]=i("h2",{id:"auto-scaling",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#auto-scaling"},[i("span",null,"Auto Scaling")])],-1)),i("p",null,[s[19]||(s[19]=a("Zilla will start workers that default to the CPU cores it is allowed to use. This makes horizontal scaling easy with a 1:1 ratio of instances to workers. Any of the default scaling metrics based on server CPU usage will enable Zilla to handle traffic spikes. Additionally, Zilla ")),l(n,{to:"/reference/config/overview.html#telemetry"},{default:e(()=>s[16]||(s[16]=[a("Telemetry")])),_:1}),s[20]||(s[20]=a(" configuration provides more data when determining how to scale. The ")),l(n,{to:"/how-tos/deploy-operate/autoscale-k8s.html"},{default:e(()=>s[17]||(s[17]=[a("Autoscaling on K8s")])),_:1}),s[21]||(s[21]=a(" guide demonstrates using metrics from the ")),l(n,{to:"/reference/config/telemetry/exporters/prometheus.html"},{default:e(()=>s[18]||(s[18]=[a("Prometheus exporter")])),_:1}),s[22]||(s[22]=a(" to horizontally scale Zilla on k8s."))]),s[36]||(s[36]=t('<h2 id="enable-incubator-features" tabindex="-1"><a class="header-anchor" href="#enable-incubator-features"><span>Enable Incubator Features</span></a></h2><blockquote><p>Progress on incubator features can be found on the <a href="https://github.com/orgs/aklivity/projects/4" target="_blank" rel="noopener noreferrer">Zilla roadmap</a>.</p></blockquote><p>Zilla maintains functioning features that may have more work or design changes in a separate install directory called <code>incubator</code>. These are released with Zilla for the community to use and provide feedback or suggestions on how to improve the feature. The package name doesn&#39;t change meaning incubator features can be added to the Zilla runtime engine whenever they are ready or needed. Incubator features are loaded when the <code>zilla.incubator.enabled</code> java property is set to true.</p><p>The <code>ZILLA_INCUBATOR_ENABLED</code> environment variable will set the incubator java option when set to <code>true</code>. Add the environment variable wherever you are running zilla.</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#000000;--shiki-dark:#D4D4D4;--shiki-light-bg:#FFFFFF;--shiki-dark-bg:#1E1E1E;"><pre class="shiki shiki-themes light-plus dark-plus vp-code"><code><span class="line"><span>ZILLA_INCUBATOR_ENABLED=true</span></span></code></pre></div><h2 id="export-trace-level-log-dump" tabindex="-1"><a class="header-anchor" href="#export-trace-level-log-dump"><span>Export <code>TRACE</code> level Log Dump</span></a></h2>',6)),i("p",null,[s[25]||(s[25]=a("The ")),l(n,{to:"/reference/config/zilla-cli.html#zilla-dump"},{default:e(()=>s[23]||(s[23]=[a("zilla dump")])),_:1}),s[26]||(s[26]=a(" command will capture all of the internal events at the stream level for a detailed analysis of what zilla was doing. These logs are captured down to the nanosecond and are exported as a ")),s[27]||(s[27]=i("code",null,".pcap",-1)),s[28]||(s[28]=a(" file to be used with ")),s[29]||(s[29]=i("a",{href:"https://wiki.wireshark.org/SampleCaptures",target:"_blank",rel:"noopener noreferrer"},"Wireshark",-1)),s[30]||(s[30]=a(". You can find instructions on how to view the capture in wireshark in the zilla dump ")),l(n,{to:"/reference/config/zilla-cli.html#i-install-plugin-directory"},{default:e(()=>s[24]||(s[24]=[a("plugin install section")])),_:1}),s[31]||(s[31]=a("."))])])}const v=d(c,[["render",u],["__file","index.html.vue"]]),b=JSON.parse('{"path":"/how-tos/deploy-operate/","title":"Deploy and Operate Zilla","lang":"en-US","frontmatter":{"description":"Deploy and Operate Zilla Install on MacOS via Homebrew You can install Zilla using our homebrew tap. Now you can run any zilla.yaml config. Running Zilla via Docker You can run ...","gitInclude":[],"head":[["meta",{"property":"og:url","content":"https://docs.aklivity.io/zilla-docs/next/how-tos/deploy-operate/"}],["meta",{"property":"og:site_name","content":"Documentation"}],["meta",{"property":"og:title","content":"Deploy and Operate Zilla"}],["meta",{"property":"og:description","content":"Deploy and Operate Zilla Install on MacOS via Homebrew You can install Zilla using our homebrew tap. Now you can run any zilla.yaml config. Running Zilla via Docker You can run ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Deploy and Operate Zilla\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Install on MacOS via Homebrew","slug":"install-on-macos-via-homebrew","link":"#install-on-macos-via-homebrew","children":[]},{"level":2,"title":"Running Zilla via Docker","slug":"running-zilla-via-docker","link":"#running-zilla-via-docker","children":[]},{"level":2,"title":"Deploying Zilla via Helm","slug":"deploying-zilla-via-helm","link":"#deploying-zilla-via-helm","children":[{"level":3,"title":"Mapping TCP ports through the official ingress-nginx ingress controller","slug":"mapping-tcp-ports-through-the-official-ingress-nginx-ingress-controller","link":"#mapping-tcp-ports-through-the-official-ingress-nginx-ingress-controller","children":[]},{"level":3,"title":"Adding files to the Zilla pod","slug":"adding-files-to-the-zilla-pod","link":"#adding-files-to-the-zilla-pod","children":[]},{"level":3,"title":"Get diagnostics from Zilla pods","slug":"get-diagnostics-from-zilla-pods","link":"#get-diagnostics-from-zilla-pods","children":[]}]},{"level":2,"title":"Auto Reconfigure","slug":"auto-reconfigure","link":"#auto-reconfigure","children":[]},{"level":2,"title":"Auto Scaling","slug":"auto-scaling","link":"#auto-scaling","children":[]},{"level":2,"title":"Enable Incubator Features","slug":"enable-incubator-features","link":"#enable-incubator-features","children":[]},{"level":2,"title":"Export TRACE level Log Dump","slug":"export-trace-level-log-dump","link":"#export-trace-level-log-dump","children":[]}],"readingTime":{"minutes":4.04,"words":1213},"filePathRelative":"how-tos/deploy-operate/index.md","autoDesc":true}');export{v as comp,b as data};
